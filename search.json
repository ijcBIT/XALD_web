[
  {
    "objectID": "horvath.html",
    "href": "horvath.html",
    "title": "Methylation: Epigenetic clock",
    "section": "",
    "text": "Context\nMany different approaches have been used to predict age from epigenetic marks. Possibly the most popular being the method proposed by Horvath et. al. Epigenome-wide association study and epigenetic age acceleration associated with cigarette smoking among Costa Rican adults\n\n\n\n\n\n\nCalculation of epigenetic aging biomarkers\n\n\n\nWe calculated all epigenetic aging biomarkers utilizing the online Horvath calculator (http://dnamage.genetics.ucla.edu/) with the advanced analysis option. The outcome of interest was the “AgeAccelerationResidual” or residuals resulting from a linear regression model where each DNA methylation clock is regressed on chronological age of each participant. We refer to all acceleration measures as Epigenetic Age Acceleration (EAA) for the specific clock and defined the residuals of the DNA methylation estimate of telomere length linearly regressed on chronological age as DNAmTL adjusted for age. A positive EAA indicates that the estimated epigenetic age is higher than the chronological age (increased biological aging) and a negative DNAmTL adjusted for age reflects a shorter telomere length. In addition, we tested Extrinsic EAA (EEAA) and Intrinsic EAA (IEAA) for Hannum’s and Horvath’s clocks, respectively51. The EEAA measure is associated with age-related changes in blood cell counts due to immune system aging and is calculated by upweighting the contributions of age-associated blood cell counts (naive cytotoxic T cells, exhausted cytotoxic T cells, and plasmablasts). The IEAA measure is independent of blood cell counts, represents intrinsic cellular aging, and is calculated by adding immune cell counts in addition to chronological age when calculating regression residuals. Analyses of epigenetic clocks included the 489 participants with high quality DNA methylation data.\n\n\n\n\nEpigenetic Age Acceleration (EAA):\nFrom the results of the Epigenetic Age Clock calculator we are going to use the following:\n\nAgeAccelerationResidualHannum Hannum et al. (2013):\n\n\nThe predicted age has been calculated using blood samples, based on work by Hannum in Ideker lab 2013.\n\n\nAgeAccelGrimLu, Quach, et al. (2019):\n\n\nGrimAge is considered the best mortality predictor available. Developed by Ake Lu and Steve Horvath.\nbased on seven DNA methilation estimators of plasma proteins and a DNA methylation estimator of smoking pack-years\n\n\nAgeAccelPheno Levine et al. (2018):\n\n\nPhenoAge morbidity & mortality predictor, developed by Morgan Levine in Steve Horvath’s lab.\nThis biomarker was developed using data from whole blood, it correlates strongly with age in every tissue and cell tested.\n\n\nIEAA Chen et al. (2016) Horvath (2013):\n\n\n\nIntrinsic cellular age Horvath: Intrinsic cell aging measure, which tries to eliminate effects of cellular composition.\n\n\nIEAA.HannumChen et al. (2016) Hannum et al. (2013)\n\n\nIntrinsic cellular age Hannum: Intrinsic cell aging measure, which tries to eliminate effects of cellular composition.\n\n\nDNAmTLAdjAge Lu, Seeboth, et al. (2019):\n\n\nThe residuals of the DNA methylation estimate of telomere length linearly regressed on chronological age.\n\nData preparation:\n\n\nCode\nlibrary(data.table)\nss_adults&lt;-readRDS(\"data/ss_Adults.rds\")\nss_adults[,SID:=Sample_Name]\nss_adults$Sample_Name&lt;-NULL\n\n\n\n\nCode\nss_all&lt;-readRDS(\"data/SS.rds\")\nss_all$Female=0\nss_all$Tissue=\"Blood PBMC\"\nss_all[,SampleID:=Sample_Name]\nss_all$Sample_Name&lt;-NULL\n\ndata.table::setcolorder(ss_all,\"SampleID\")\nbetas&lt;-minfi::getBeta(readRDS(\"data/controls.rds\"))\nb&lt;-data.table::as.data.table(betas,keep.rownames = T)\nb[,ProbeID:=rn]\nb$rn&lt;-NULL\nss_horvath &lt;- ss_all[SampleID %in% intersect(colnames(b),ss_all$SampleID),]\nb&lt;-b[,.SD,.SDcols=c(\"ProbeID\",intersect(colnames(b),ss_all$SampleID))]\ndata.table::setcolorder(b,c(\"ProbeID\",ss_horvath$SampleID))\ndata.table::fwrite(b,\"data/controls_betas.csv\")\ndata.table::fwrite(ss_horvath,\"data/ss_controls.csv\")\n\n\n\n\nCode\nsource(\"R/functions.R\")\nss_horvath&lt;-ss_adults\nss_horvath$Female=0\nss_horvath$Tissue=\"Blood PBMC\"\nss_horvath[,SampleID:=Sample_Name]\nss_horvath$Sample_Name&lt;-NULL\ndata.table::setcolorder(ss_horvath,\"SampleID\")\nb&lt;-data.table::as.data.table(betas,keep.rownames = T)\nb[,ProbeID:=rn]\nb$rn&lt;-NULL\ndata.table::setcolorder(b,c(\"ProbeID\",ss_horvath$SampleID))\ndata.table::fwrite(b,\"data/adult_betas.csv\")\ndata.table::fwrite(ss_horvath,\"data/ss_adults.csv\")\n\n\nNow this data is sent to the horvath calculator and these are the results:\n\n\nCode\nclock_adults &lt;- data.table::fread(\"data/DNAmAgeCalcProject_2124_Results.csv\")\nclock_ctl &lt;- data.table::fread(\"data/DNAmAgeCalcProject_2638_Results.csv\")\n\n\n\n\nCode\nacc&lt;- c(names(clock_ctl)[names(clock_ctl)%like%\"AgeAccel\"],c(\"IEAA\", \"IEAA.Hannum\"))\ncols &lt;- c(\"SID\",acc,\"DNAmTLAdjAge\")\ncols\n\n\n[1] \"SID\"                           \"AgeAccelerationResidualHannum\"\n[3] \"AgeAccelGrim\"                  \"AgeAccelPheno\"                \n[5] \"IEAA\"                          \"IEAA.Hannum\"                  \n[7] \"DNAmTLAdjAge\"                 \n\n\n\n\nCode\nclock&lt;-rbind(clock_adults[,.SD,.SDcols=cols],clock_adults[,.SD,.SDcols=cols])\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nCode\nss_all&lt;-readRDS(\"data/SS.rds\")\n\nss_all[,SID:=make.names(Sample_Name)]\nsamples &lt;- intersect(clock$SID,ss_all$SID)\nmerge(clock,ss_all[,.SD,.SDcols=c(\"SID\",\"Condition\")], by=c(\"SID\"))-&gt;dt\ndt_long &lt;- melt(dt,id.vars = c(\"SID\",\"Condition\"))\n\n\n\n\nCode\nlibrary(ggplot2)\np2&lt;-ggplot(dt_long, aes(x=Condition, y=value, fill= Condition)) +\n     geom_boxplot(aes(fill=Condition),outlier.fill=\"ivory\",alpha = 0.5) +\n      # scale_fill_manual(ys=levels(col_subclass)) +\n      # geom_jitter(#color=pdata$color,\n      #             size=0.1,show.legend = TRUE,\n      #             alpha=0.2) +\n\n      #theme_ipsum() +\n      theme(\n        legend.position=\"left\",\n        plot.title = element_text(size=11)\n      ) +\n      ggtitle(\"DNAm-based age acceleration between XALD conditions\") +\n      xlab(\"Condition\")+\n    ylab(\"Age acceleration\")+\n            scale_x_discrete(guide = guide_axis(angle = 60))+\n    \n    facet_wrap(as.formula(paste(\"~ variable\" )),ncol = 3,scales=\"free\")\np2\n\n\n\n\n\nThis results suggest age acceleration for the controls in the extrinsic measures. This differences seem to disappear in the intrinsic approach where cell count of different cell populations is taken into account on the regeresion model.\n\n\n\n\n\nReferences\n\nChen, Brian H, Riccardo E Marioni, Elena Colicino, Marjolein J Peters, Cavin K Ward-Caviness, Pei-Chien Tsai, Nicholas S Roetker, et al. 2016. “DNA Methylation-Based Measures of Biological Age: Meta-Analysis Predicting Time to Death.” Aging 8 (September): 1844–65. https://doi.org/10.18632/aging.101020.\n\n\nHannum, Gregory, Justin Guinney, Ling Zhao, Li Zhang, Guy Hughes, SriniVas Sadda, Brandy Klotzle, et al. 2013. “Genome-Wide Methylation Profiles Reveal Quantitative Views of Human Aging Rates.” Molecular Cell 49 (January): 359–67. https://doi.org/10.1016/j.molcel.2012.10.016.\n\n\nHorvath, Steve. 2013. “DNA Methylation Age of Human Tissues and Cell Types.” Genome Biology 14: R115. https://doi.org/10.1186/gb-2013-14-10-r115.\n\n\nLevine, Morgan E, Ake T Lu, Austin Quach, Brian H Chen, Themistocles L Assimes, Stefania Bandinelli, Lifang Hou, et al. 2018. “An Epigenetic Biomarker of Aging for Lifespan and Healthspan.” Aging 10 (April): 573–91. https://doi.org/10.18632/aging.101414.\n\n\nLu, Ake T, Austin Quach, James G Wilson, Alex P Reiner, Abraham Aviv, Kenneth Raj, Lifang Hou, et al. 2019. “DNA Methylation GrimAge Strongly Predicts Lifespan and Healthspan.” Aging 11 (January): 303–27. https://doi.org/10.18632/aging.101684.\n\n\nLu, Ake T, Anne Seeboth, Pei-Chien Tsai, Dianjianyi Sun, Austin Quach, Alex P Reiner, Charles Kooperberg, et al. 2019. “DNA Methylation-Based Estimator of Telomere Length.” Aging 11 (August): 5895–5923. https://doi.org/10.18632/aging.102173."
  },
  {
    "objectID": "standard.html",
    "href": "standard.html",
    "title": "Standard analysis",
    "section": "",
    "text": "There are 2 disease conditions AMN and cerebral (cALD for child cAMN for adults) and 2 age groups adults &gt;=18 & child &lt;18.\n\n\nCode\nsource(\"R/functions.R\")\nlibrary(data.table)\nss&lt;-readRDS(\"data/SS.rds\")\nss$age_grp &lt;- \"Adult\"\nss[Age &lt; 18, age_grp:=\"Child\"]\ntable(ss$age_grp,ss$Condition)\n\n\n       \n        AMN cALD cAMN CTL.adult CTL.child\n  Adult  52    0    8        12         0\n  Child   0   12    0         0        12\n\n\nThe main goal is to study adults and whether the relation between age and methylation is different between control and diseased AMN vs CTL.adult. A secondary analysis is the inclusion of child subjects, which can be included in the second part of the analysis."
  },
  {
    "objectID": "standard.html#workflow",
    "href": "standard.html#workflow",
    "title": "Standard analysis",
    "section": "Workflow:",
    "text": "Workflow:\nThe standard analysis has 3 steps:\n\n1.Pre-processing:\n\nBackground correction:\nData is cleaned and filtered before being analysed. The preprocessNoob function from minfi package is used to remove background noise. And a visual inspection of the data is done raw-qc\n\n\nData filtering:\nThe following filters are applied:\n\nProbes: Only probes with a detection p.value &lt; 0.01 for each sample are retained. (P-value calculated with minfi::detectionP())\nSample: Only samples with at least 90% of the probes are retained.\n\nAfter applying these filters one sample was discarded: lnf-21.5, CTL.adult, 44\n\n\nCode\nss &lt;- ss[Sample_Name != \"lnf-21.5\",]\n\n\n\n\n\n2.Differential analysis:\nOnce data is clean the diffrences in methylation between different groups is analysed using regression models. In this case we use the limma package and the\nfollowing models are tested:\n\nmodel 1:\nHere we used only adults and created a variable called Type , which contains 2 groups:\n\ndisease: merges AMN and cAMN together in a single group.\ncontrols: the adult controls.\n\n\n\nCode\ndtable(ss[age_grp==\"Adult\", .(Sample_Name,Type)])\n\n\n\n\n\n\n\n\n\nCode\ntable(ss[age_grp==\"Adult\", Type])\n\n\n\nControl Disease \n     11      60 \n\n\nFormula: meth ~ 0 + AMN_Type\nNo difference at probe-level or region level observed.\n\n\nmodel 2:\nHere we used all samples child and adults alike and created the Condition variable, which contain 5 groups formed by all the possible combinations of disease group and age:\n\nCTL.adult: Control samples for adults\nCTL.child: Control samples for childs\nAMN: Adults with the disease condition 1\ncAMN: Adults with the disease condition 1 & condition 2\ncALD: Children with the disease condition 2\n\n\n\nCode\ndtable(ss[, .(Sample_Name,Condition)])\n\n\n\n\n\n\n\n\n\nCode\ntable(ss[, Condition])\n\n\n\n      AMN      cALD      cAMN CTL.adult CTL.child \n       52        12         8        11        12 \n\n\nFormula: meth ~ 0 + Condition\nThis model was statistically significant for the contrast cALD-cAMN. at the probe level with 116 DMPs.\nNo difference at region level observed.\n\n\nmodel 3 = m2 + Age as a covariate\nFormula: meth ~ 0 + Condition + Age\nNo difference at probe-level or region level observed.\n\n\n\n3. Pathway analysis\nThere were only significant results for model 2 at individual probe level:\n\n\n\nPathway analysis from genes associated to DMPs in model 2."
  },
  {
    "objectID": "standard.html#discussion",
    "href": "standard.html#discussion",
    "title": "Standard analysis",
    "section": "Discussion",
    "text": "Discussion\nWe performed a Standard methylation analysis, following the usual workflow.\nFrom this analysis we only observed methylation differences between diseased childs, which show the cerebral condition and diseased adults without that condition. One of the factors that could explain those differences in methylation is age.\nThus, in order to adjust for age, the same analysis was repeated introducing the known biological age as a covariate in the linear model (m3) and no differences where observed.\nTo further study if there is an age-accelerating effect on the disease we propose:\n\nGenereate a regression model with age-corrected beta values, to remove the effect of age from the methylation values.\nLook for specific age signature in our data by predicting age-related sites within the controls and checking for enrichment of those sites in the disease.\nAnalysing previously reported age-related sites from literature.\n\nReproducing age-acceleration analysis from existing literature."
  },
  {
    "objectID": "summary.html",
    "href": "summary.html",
    "title": "Summary",
    "section": "",
    "text": "Summary\nIn this project we tried to answer the following questions:\n\nIs there an age-accelerating factor for XALD patients according to the changes in DNA methylation?\nWhich are the changes in DNA methylation associated with XALD disease?\n\nTo start with, we performed a conventional analysis following our standard workflow for differential methylation analysis ( data preprocessing, filtering, identification of differentially methylated Probes,DMPs, and Regions, DMRs, and pathway analysis of the associated genes) using different sets of parameters (pvalu, FDR, min. methylation difference). Due to the imbalanced study design with a much smaller group of control vs disease cases and we repeated the same analysis including additional control cases from public datasets (GEO).\n\nConventional analysis using standard pipline.\nConventional analysis including controls from GEO.\n\nFrom this first approach we could identify some enriched pathways with genes associated with DMPs (individual probes). Nevertheless, by adding age to the model as a covariate this differences where lost.\n\n\n\nPathway analysis from genes associated to DMPs in model 2.\n\n\nSince the results from this conventional analysis where not satisfying we then tryed some other analysis replicating existing literature on DNA methylation associated with age:\n\nChecking for age-related signatures following the workflow described in Steegenga et al. (2014)\n\nHere we saw some differences in methylation for our data for the set related with no change in gene expression.\n\n\nCode\nreadRDS(\"data/ztab.rds\")\n\n\n\n?(caption)\n\n\n\n              ref     model condition    N       p.value      Case       Ctl\n1          cgSetm residuals      cAMN 4556  0.000000e+00 0.5179677 0.4919976\n2        cgSet_NO residuals      cAMN 3956  0.000000e+00 0.5182289 0.4917175\n3         cgIn_NO residuals      cAMN  837  0.000000e+00 0.5238554 0.4841475\n4  cgIn_consensus residuals      cAMN 3826 4.611327e-290 0.5112390 0.4955195\n5       cgSet_pre residuals      cAMN 6878 2.209406e-268 0.5089070 0.4976330\n6          cgSetm residuals   Disease 4556 4.091372e-245 0.5014336 0.4919976\n7        cgSet_NO residuals   Disease 3956 1.265880e-228 0.5014942 0.4917175\n8         cgIn_NO residuals   Disease  837 8.489375e-176 0.5027597 0.4841475\n9        cgIn_top residuals      cAMN 4695 2.507026e-161 0.5082866 0.4977346\n10         cgSetm residuals       AMN 4556 1.790816e-129 0.4988899 0.4919976\n11       cgSet_NO residuals       AMN 3956 7.363714e-123 0.4989196 0.4917175\n12        cgIn_NO residuals       AMN  837 2.064456e-118 0.4995142 0.4841475\n13    cgSet_Exprs residuals      cAMN  638 1.656484e-100 0.5163686 0.4938602\n14       cgIn_pre residuals      cAMN 3011  4.104878e-70 0.5075933 0.4989758\n15 cgIn_consensus residuals   Disease 3826  8.610963e-67 0.5008364 0.4955195\n16      cgSet_pre residuals   Disease 6878  6.053748e-36 0.5005079 0.4976330\n17 cgIn_consensus residuals       AMN 3826  5.567936e-33 0.4992360 0.4955195\n18       cgIn_top residuals   Disease 4695  8.554518e-22 0.5004015 0.4977346\n19    cgSet_Exprs residuals   Disease  638  1.846942e-21 0.5010346 0.4938602\n20      cgSet_pre residuals       AMN 6878  8.462111e-12 0.4992157 0.4976330\n21    cgSet_Exprs residuals       AMN  638  2.462806e-10 0.4986755 0.4938602\n22       cgIn_top residuals       AMN 4695  2.176250e-07 0.4991884 0.4977346\n23       cgIn_pre residuals   Disease 3011  2.126750e-04 0.5002614 0.4989758\n24       cgIn_pre residuals       AMN 3011  6.526093e-01 0.4991334 0.4989758\n           diff\n1  0.0259701017\n2  0.0265114143\n3  0.0397079641\n4  0.0157194645\n5  0.0112740100\n6  0.0094359547\n7  0.0097766251\n8  0.0186122048\n9  0.0105519788\n10 0.0068922398\n11 0.0072020421\n12 0.0153667034\n13 0.0225083193\n14 0.0086175199\n15 0.0053169035\n16 0.0028748712\n17 0.0037165095\n18 0.0026668518\n19 0.0071743510\n20 0.0015826960\n21 0.0048152789\n22 0.0014537553\n23 0.0012856247\n24 0.0001576409\n\n\n\n\n4. Checking age acceleration as decribed by Horvath (2013)\nWe identified a particular set of age-related genes that were differentially methylated for the XALD + cerebral condition in adult patients for specific sites that had been previously reported to be related with age.\nSee ?@tbl-adult_z-test_cov_model\n\nWe also identified the main pathways associated with the disease.\n\n\n\n\n\n\nReferences\n\nHorvath, Steve. 2013. “DNA Methylation Age of Human Tissues and Cell Types.” Genome Biology 14: R115. https://doi.org/10.1186/gb-2013-14-10-r115.\n\n\nSteegenga, Wilma T., Mark V. Boekschoten, Carolien Lute, Guido J. Hooiveld, Philip J. De Groot, Tiffany J. Morris, Andrew E. Teschendorff, Lee M. Butcher, Stephan Beck, and Michael Müller. 2014. “Genome-Wide Age-Related Changes in DNA Methylation and Gene Expression in Human PBMCs.” Age 36: 1523–40. https://doi.org/10.1007/S11357-014-9648-X."
  },
  {
    "objectID": "signature.html",
    "href": "signature.html",
    "title": "age signature",
    "section": "",
    "text": "There are 2 ways in which we are going to check for the age signature of our controls.\n\n1.A: By checking if there are significant DMPs on our data comparing young and old controls (healthy samples)\n1.B: By subsetting the EPIC methylation array sites to those that have been previously reported to change methylation with age.\n\n\n\nTo answer question 1.B we are going to take as a reference the work made by Wilma, T. et al Steegenga et al. (2014)\nIn their paper they present 3 datasets: 1. cgSet_Exprs: The set of probes that come from observed changes in methylation AND in expression (398 genes) 2. cgSet_NO: The set of probes that come from observed changes in methylation BUT NOT expression (2390 genes) 3. cgSet_pre: The set of probes reported to be age-related on previous literature.\nAnd we created a new one combining 2 &3: 4. cgSetm: The combination/union of cgSet_Exprs & cgSet_NO\nSo let’s prepare our data replicating their workflow:\n\n\n450k array where pre-processed and cleaned and the old subjects where compared to the young subjects.\n20,917 were significantly regulated (Lima t test, p &lt; 0.01) between the group of old and young subjects. Over 5 % methylation difference between the mean of the group of the young and old subjects was found for 10,625. 7,598 gene-related and 3,027 intergenic probes. From the 7,598 gene-related 640 probes where further discarded because of pseudo- and uncharacterized genes, antisense RNAs, long intergenic nonprotein coding RNAs and micro-RNAs.\nFinally a clean set of 6958 probes where selected and the most significant differentially expressed genes were identified using −2 &gt; t value &gt; 2 as a cut-off. Fig 2A\n\n398 genes where selected as the most significant differentially expressed genes and 170 of those have at least 2 associated DMPs.\nThe following table corresponds to supplementary table 2 and contains the data they usedin the article.\n\n\n\n\n\n\n\n\n\n\n\n\n\nLoaded data has been filtered out for single nucleotide polymorphism (SNP) at or near the target CpG with minor allele frequency equal or larger than 1 % and probes that contained more than 2 SNPs.\n\n\nCode\nlibrary(data.table)\nlibrary(targets)\nlibrary(SummarizedExperiment)\nlibrary(S4Vectors)\nss &lt;- readRDS(\"data/SS.rds\")\nss_ctl &lt;- ss[Type==\"Control\",]\n\n# rgSet &lt;- cnv.methyl::read.metharray.exp.par(targets=ss_ctl,ncores = 36,folder = \"analysis/intermediate/\")\nrgSet &lt;- minfi::read.metharray.exp(targets = ss_ctl)\n\nmset &lt;- name_rgset(rgSet,ss_ctl,exclude=\"206702460034_R05C01\",newname=\"Sample_Name\")\n\ncontrols&lt;-filter(                                         # 1.- Filters: -probes: pval&lt;0.01 \n    targets=ss_ctl, rgSet=mset,sampGroups=\"Sample_Group\", #              -samples: 10% probes fail\n    qc_folder = \"analysis/\")\nss_ctl &lt;- data.table::data.table(as.data.frame(controls@colData))\n\n\n\n\n\n\n\nCode\nidcol=\"Sample_Name\"\nctl_qc_dir=params$ctl_qc_dir\ndir.create(ctl_qc_dir,recursive = T, showWarnings = F)\ncontrols_qc &lt;- \nqc(                                                       # Makes qc plots:qcReport, density, beanplot, mean_qc \n    controls,sampGroups = \"Sample_Group\",sampNames=idcol,idcol=idcol, qc_folder = ctl_qc_dir\n    )\n\n\n\n\n\ndensity_plot\n\n\n\n\n\nbean_plot\n\n\nThere are 1.05^{6} probes that pass QC and 23 control samples in our dataset.\n\n\nCode\ntable(ss_ctl$Condition)\n\n\n\n      AMN      cALD      cAMN CTL.adult CTL.child \n        0         0         0        11        12 \n\n\n\n\n\nFollowing the aforementioned paper Steegenga et al. (2014) we now normalize the data using the subset-quantile within array normalization (SWAN) method:\n\n\nCode\nlibrary(minfi)\nnorm&lt;-minfi::preprocessSWAN(controls)\n\n\n\n\n\n\nTo test the effect of age on our controls we will split our samples into adult +18 and young &lt;18 subjects. Then we will fit a model to compare the methylation levels of this 2 groups.\n\n\nCode\nmvals&lt;-getM(norm) \nfull_mod&lt;-mod(object = mvals, group_var = \"Condition\",\n                        singular=F,pairwise = T,\n                        metadata = ss_ctl,\n                        idcol=\"Sample_Name\")\nsaveRDS(full_mod,\"data/full_mod.rds\")\n\n\n\n\nCode\nsig_mod&lt;-full_mod[abs(full_mod$t)&gt;2 & full_mod$p.value &lt; 0.01 ,]\n\nsaveRDS(sig_mod,\"data/sig_mod.rds\")\n\n\n139531 were significantly regulated (Lima t test, p &lt; 0.01) between the group of adult and child subjects using −2 &gt; t value &gt; 2 as a cut-off.\n\n\nCode\nlibrary(cnv.methyl)\nlibrary(minfi)\ndmps &lt;- cnv.methyl::DMPextr(fit = sig_mod,                         # Toptable & stats\n                                            ContrastsDM = colnames(sig_mod$contrasts),\n                                            beta_normalized = minfi::getBeta(controls),\n                                            p.value = 0.01,\n                                            mDiff = 0.05,\n                                            ann = minfi::getAnnotation(controls),\n                                            writeOut = F)\ndmps$Type&lt;-ifelse(dmps$diff_meanMeth&gt;0,\"Hyper\",\"Hypo\")\n\n\nFrom here we could extract our own group of DMPs comparing the two age groups from the contrasts.\n\n\nCode\nDMPs&lt;-data.table::as.data.table(dmps)\nDMPs&lt;-DMPs[,UCSC_RefGene_Name:=sapply(UCSC_RefGene_Name,function(x) paste(unique(unlist(strsplit(x,\";\"))),collapse = \";\"))]\nDMPs[nchar(UCSC_RefGene_Name)&gt;1,]\nsaveRDS(DMPs,\"data/dmps.rds\")\n\n\nSo yes, there are actually 55501 DMPs.\n\n\nIn the following plots you can observe\n\n\nCode\nplotDMP(data.table::as.data.table(dmps))\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nNow we already checked that there are methylation differences in our data by separating controls into young and old. Since our samples are only controls and the only controlled difference between them is age, this suggests that the observed methylation differences are related to that factor. Nevertheless, there could be other underlying variables affecting the methylation levels between the 2 conditions that we ignore.\nSo far, we followed the proceeding from the paper in our analysis in order to mimic their workflow so the results are comparable. Nevertheless, they also measured expression values, which they used to correlate with methylation levels in order to filter the gene candidates for their age-related profile. In our case, there is no expression, so we can’t construct a dataset of candidate genes taking into account gene expression. Eventhough, we can use the same datasets from their previous work on our data in order to see if the set with expression and without expression behave in a different way.\n\n\n\n\nAs mentioned previously, another way to find out if there is a change in methylation associated with aging in our data is looking at those sites that have been previously reported to show this association. We will use the PBMC reference datasets (with/without expression change) plus the one from previous literature that is also mentioned in the paper from Steegenga et al. (2014):\n\n\n\n\nCode\nlibrary(readxl)\npaper_betas &lt;- suppressMessages( readxl::read_excel(\"data/11357_2014_9648_MOESM2_ESM.xls\", \n    sheet = \"sTable 2S\", skip = 2))\npaper_betas2 &lt;- suppressMessages(readxl::read_excel(\"data/11357_2014_9648_MOESM2_ESM.xls\", \n    sheet = \"sTable 3S\", skip = 2))\npaper_betas3 &lt;- suppressMessages(readxl::read_excel(\"data/11357_2014_9648_MOESM2_ESM.xls\", \n    sheet = \"sTable 4S\", skip = 6))\n\n\n\n\n\nThere are 4 reference probelists:\n\ncgSet_Exprs: The set of probes that come from observed changes in methylation BUT NOT in expression (398 genes)\ncgSet_NO: The set of probes that come from observed changes in methylation AND expression (2390 genes)\ncgSetm: The combination/union of cgSet_Exprs & cgSet_NO\ncgSet_pre: The set of probes reported to be age-related on previous literature.\n\n\n\nCode\nprobelist &lt;- list(\n  cgSet_Exprs = paper_betas$ProbeID,\n  cgSet_NO = paper_betas2$ProbeID,\n  cgSetm = unique(c(paper_betas$ProbeID,paper_betas2$ProbeID)),\n  cgSet_pre = paper_betas3$`Probe nr`\n\n)\nsaveRDS(probelist,\"data/probelist.rds\")\n\n\n\n\n\nWe have 2 models, the full model, which has all the probes from the normalised data in it full_mod and the same model which has been filtered according to the same criteria as in the paper sig_mod (0.01 pval & +-2t) to keep only sites with a significant change in methylation.\nSo, as we saw in 1A we get a set of +50K DMPs, following the steps described in the paper to construct a new reference dataset from our data (excluding the part where data is crossed with expression).\nWe believe those sites are related to age because the model was built comparing old vs young healthy subjects, but there might be other factors affecting the differences in methylation, there are 2 solutions we propose:\n\nsig_mod: We could either intersect our significant probes 139531 with the sites that have been previously reported to be related with age.\nfull_mod: Test the whole reference datasets on our data.\n\nsig_mod may offer better results, since it is based on the differences present in our own data, but for the same reason it could also introduce bias.\nLet’s take a look at the sample size of each of the age_profile datasets. (4 references x 2 models = 8 datasets):\n\ndataset: The name of the reference dataset used\nN_Age_ref: Total size of the reference dataset\nN_tested: The subset of probes from each reference dataset that we tested (are present in our chip and have not been discarded in QC steps)\nN_DMPs: Number of probes that are significantlly methylated between the 2 groups that are also present in each of the age reference subset.\nobserved: Number of DMPs with percentajes relative to reference datasets.\nexpected: Expected number of DMPs + percentage of DMPs (N_DMPs/N_total)\n\n\n\nCode\nlibrary(data.table)\ntab &lt;- t(sapply(probelist,function(x) table(rownames(full_mod) %in% x)))\ntab2 &lt;- t(sapply(probelist,function(x) table(rownames(sig_mod) %in% x)))\ndtab&lt;-data.table::data.table(\n  dataset = c(rownames(tab)),\n  N_Age_ref = sapply(probelist,NROW),\n  N_tested = paste0(tab[,2], \" (\",round(tab[,2]/sapply(probelist,NROW)*100,2), \"%)\"),\n  N_DMPs = tab2[,2]\n  \n)\ndtab[,observed:=paste0(N_DMPs, \"/\", tab[,2], \" (\",round((N_DMPs/tab[,2])*100,2), \"%)\"  )]\ndtab[, expected:=paste0( round(tab[,2] * round( NROW(sig_mod$coefficients)/NROW(full_mod$coefficients) *100,2)/100),\" (\",round( NROW(sig_mod$coefficients)/NROW(full_mod$coefficients) *100,2),\"%)\")]\n\n\n\n\nCode\ndtab\n\n\n\n\n Table 1.1:  Enrichment of each age-related reference set in the age control\nmodel \n  \n\n\n\n\nSince the reference datasets have been previously reported to be associated with age, they can be used to filter the significant sites from our model to select those with further evidence to be related with ageing. In the table above we can observe that there is a good proportion of DMPs in the 2 age groups from the controls associated with these age-related references. After data preprocessing around 90% of the cgs for each reference set is present in our data, which we consider is a fair representation. Our significant dataset captures more than 30% of the probes for each reference dataset, while if you look at all the different probes from the array, the overall percentage of DMPs between young and adults is 16.14% which suggests that there is some overlap between previously reported age-related sites and DMPs between young and adult controls from our study. Nevertheless, it is also advisable to include the full reference sets in further analysis.\nTo analyse DMPs in age-related sites in the disease, we will use a combination of these reference sets, as well as sub-samples corresponding to the intersections between DMPs from our controls and the reference sets. For more about inhouse reference datasets Section 1.5 .\n\n\n\nWe can now construct each of the 8 datasets with mean beta values for young/adult groups:\n\n\nCode\nbetas &lt;- minfi::getBeta(controls)\n\n# Row index to multiply by betas taking the columns present in each contrast multiplying by 1/0\ndesign_FULL &lt;- t(full_mod$design)\n# For each row on design (columns selected for each contrast) do betas * 1/0 to get the correct columns and then do the mean values for each group:\nbetas_c_FULL &lt;-apply(design_FULL , 1 , function(x) apply(betas[,ss_ctl$Sample_Name] %*% diag(x),1 , function(y) mean(y[y!=0])))\n\nbetas_c &lt;- lapply(list(full_mod,sig_mod),function(fit){\n  # Row index to multiply by betas taking the columns present in each contrast multiplying by 1/0\n  design &lt;- t(fit$design)\n  \n  dt_c&lt;-rbindlist(lapply(names(probelist), function(n){\n    idx&lt;-intersect(probelist[[n]],rownames(fit))\n    cgs&lt;-intersect(idx,rownames(betas))\n    b &lt;- betas[cgs,]\n    # For each row on design (columns selected for each contrast) do betas * 1/0 to get the correct columns and then do the mean values for each group:\n    dt=as.data.table(apply(design , 1 , function(x) apply(b %*% diag(x),1 , function(y) mean(y[y!=0]))))\n    dt$ref=n\n    dt$cg=cgs\n    dt\n    } \n  ))\n  dt_c\n})\nnames(betas_c)&lt;- c(\"full_mod\",\"sig_mod\")\npdata&lt;-rbindlist(betas_c,idcol = \"model\")\nnames(pdata)[2:3]&lt;-c(\"adult\",\"child\")\npdata[,diff:=adult-child]\npdata&lt;-pdata[!is.na(diff),]\npdata[,type:=ifelse(diff&gt;0,\"hyper\",\"hypo\")]\n\n\nWe are ready to test mean differences and plot:\n\n\n\nAppart from a quantitative approach in order to measure at which extent each reference set is related to our data, a more qualitative measure can be obtained, based on statitics. Also, these test will tell us at which extent the differences in methylation between young and adults are significant for each of the reference sets. Imagine for example, that our data has a smaller percentage of DMPs in reference set A than in set B, but the difference in methylation for sites in A are much greater than those in B. This is the kind of qualitative measurement that the statistical test will tell us.\nMethylation data is bimodal, since the effects of methylation can either occur by hyper or hypomethylation. This means the data is not going to show a normal distribution. Thus, a wilcoxon non-parametric test is used to compare the means .\n\n\nCode\nt &lt;- pdata[,wilcox.test(child,adult)$p.value,by=c(\"ref\",\"model\")]\nt\n\n\n\n\n Table 1.2:  Young vs Adult Controls methylation distributions significance\ntest. \n  \n\n\n\n\nAlso a bimodal distribution could be transformed in 2 normal distributions if we split data into hyper and hypomethylated probes.\n\n\nCode\npdata[,sd.child:=sd(child),by=type]\npdata[,sd.adult:=sd(adult),by=type]\nz_bimodal &lt;- pdata[,c(N=.N,BSDA::z.test(child,adult,sigma.x=unique(sd.child),sigma.y=unique(sd.adult))),by=c(\"model\",\"ref\",\"type\")]\n# t_bimodal &lt;- pdata[,t.test(child,adult),by=c(\"ref\",\"model\",\"type\")]\nz_bimodal[,group:=rep(c(\"child\",\"adult\"),.N/2)]\nzt&lt;- dcast(z_bimodal, ref + model + type + N + p.value ~ group, value.var = c(\"estimate\"))\nzt[,diff:=adult-child]\ndata.table::setorder(zt,p.value,diff)\nkableExtra::kbl(zt)|&gt;kableExtra::kable_classic_2()\n\n\n\n\nTable 1.3: Young vs Adult Controls methylation distributions significance test.\n\n\nref\nmodel\ntype\nN\np.value\nadult\nchild\ndiff\n\n\n\n\ncgSet_pre\nfull_mod\nhypo\n5194\n0.00\n0.43\n0.49\n-0.06\n\n\ncgSet_pre\nsig_mod\nhypo\n2946\n0.00\n0.43\n0.51\n-0.08\n\n\ncgSetm\nfull_mod\nhyper\n3290\n0.00\n0.22\n0.18\n0.04\n\n\ncgSet_NO\nfull_mod\nhyper\n2897\n0.00\n0.22\n0.18\n0.04\n\n\ncgSetm\nsig_mod\nhyper\n1471\n0.00\n0.19\n0.13\n0.05\n\n\ncgSet_NO\nsig_mod\nhyper\n1308\n0.00\n0.19\n0.13\n0.06\n\n\ncgSet_pre\nsig_mod\nhyper\n894\n0.00\n0.31\n0.25\n0.06\n\n\ncgSet_pre\nfull_mod\nhyper\n1824\n0.00\n0.32\n0.28\n0.04\n\n\ncgSetm\nfull_mod\nhypo\n1400\n0.00\n0.49\n0.53\n-0.04\n\n\ncgSet_NO\nfull_mod\nhypo\n1184\n0.00\n0.49\n0.53\n-0.04\n\n\ncgSetm\nsig_mod\nhypo\n292\n0.00\n0.47\n0.53\n-0.07\n\n\ncgSet_NO\nsig_mod\nhypo\n247\n0.00\n0.47\n0.54\n-0.07\n\n\ncgSet_Exprs\nfull_mod\nhyper\n418\n0.00\n0.23\n0.19\n0.04\n\n\ncgSet_Exprs\nsig_mod\nhyper\n175\n0.00\n0.19\n0.13\n0.05\n\n\ncgSet_Exprs\nfull_mod\nhypo\n230\n0.04\n0.47\n0.50\n-0.03\n\n\ncgSet_Exprs\nsig_mod\nhypo\n48\n0.06\n0.46\n0.52\n-0.07\n\n\n\n\n\n\n\n\nCode\n# kableExtra::kbl(z_bimodal[,.SD,.SDcols=c(\"ref\",\"model\",\"type\",\"estimate\",\"conf.int\",\"p.value\")],digits=2) |&gt; kableExtra::kable_classic()\n\n\nIn this second statistical test, instead of comparing the distribution of the two groups we are splitting the data into hyper and hypomethylation, so it adds a new layer of information. The data in the table is sorted by p.value, so it shows the most significant first, but there is the estimate mean difference too.\nThe results show that there are significant differences.\nDataset means are all significantlly diferent (either with wilcoxon or student t test). For cgSet_pre from the literature there is a decrease in methylation with age. There is an increase in methylation for the cgSet_NO dataset (without expression) and less differences for those sites correlated with expression changes.\n\n\n\n\n\nCode\np_long&lt;-melt(pdata, measure.vars=c(\"adult\",\"child\") )\np_long[,color:=ifelse(type  == \"hyper\",\"red\",\"green\")]\n\nlibrary(ggplot2)\nlibrary(viridis)\n\n\nWarning: package 'viridis' was built under R version 4.3.0\n\n\nLoading required package: viridisLite\n\n\nCode\n  p1&lt;-ggplot(p_long, aes(x=variable, y=value, fill= variable)) +\n     geom_boxplot(aes(fill=variable),outlier.fill=\"ivory\",alpha = 0.5) +\n      # scale_fill_manual(ys=levels(col_subclass)) +\n      geom_jitter(color=p_long$color,\n                  size=0.1,show.legend = TRUE,\n                  alpha=0.2) +\n\n      #theme_ipsum() +\n      theme(\n        legend.position=\"left\",\n        plot.title = element_text(size=11)\n      ) +\n      ggtitle(\"Beta ys between young and old\") +\n      xlab(\"Cells\")+\n    ylab(\"relative fraction\")+\n            scale_x_discrete(guide = guide_axis(angle = 60))+\n    \n    facet_wrap(as.formula(paste(\"~ ref + model\" )),ncol = 4)\n  \n   \np2&lt;-ggplot(p_long[ref!=\"cgSetm\",], aes(x=variable, y=value, fill= variable)) +\n     geom_boxplot(aes(fill=variable),outlier.fill=\"ivory\",alpha = 0.5) +\n      # scale_fill_manual(ys=levels(col_subclass)) +\n      # geom_jitter(#color=pdata$color,\n      #             size=0.1,show.legend = TRUE,\n      #             alpha=0.2) +\n\n      #theme_ipsum() +\n      theme(\n        legend.position=\"left\",\n        plot.title = element_text(size=11)\n      ) +\n      ggtitle(\"Beta ys between young and old\") +\n      xlab(\"Cells\")+\n    ylab(\"relative fraction\")+\n            scale_x_discrete(guide = guide_axis(angle = 60))+\n    \n    facet_wrap(as.formula(paste(\"~ ref + model\" )),ncol = 2)\np2\n\n\n\n\n\n\n\n\n\nSince we suspect that our disease is related to accelarated aging but we don’t really know if one reference data is going to be better than the other for our disease, we created a combination of reference sets that try to capture as much variability as posible. This sets start with the prefix cgIn_ to differenciate them from the previous cgSet_.\nWe will also inspect which pathways are realted to each of these sets.\n\n\nCode\npathways_refsets&lt;-list()\n\n\nIn order to analyse which pathways are associated to the DMPs, we will first annotate the probes with gene names. To do that we will use the convinient annotation provided by illumina plataform for their EPIC methylation arrays.\n\n\nCode\nlibrary(data.table)\nlibrary(IlluminaHumanMethylationEPICanno.ilm10b2.hg19)\n\n# 1. Get gene names from EPIC annotation object\nEPIC_anno&lt;-data.table::as.data.table(as.data.frame(IlluminaHumanMethylationEPICanno.ilm10b2.hg19::Other),keep.rownames = \"cg\")\ndata.table::setkey(EPIC_anno,cg)\n\n# 2. Filter for significant probes and absolute mean difference of beta values &gt; 0.05 \ndt_path&lt;-p_long[model==\"sig_mod\"&abs(diff)&gt;0.05,.SD,.SDcols=c(\"ref\",\"cg\",\"type\",\"diff\")]\n\n# 3. add gene name information to our data.table\ndata.table::setkey(dt_path,cg)\ndt_path$gene_name &lt;- EPIC_anno[dt_path$cg,UCSC_RefGene_Name]\ndt_path$Contrast=\"controls\"\n\n\n\n\nCode\nhead(dt_path)\n\n\n\n\n  \n\n\n\n\n\nThe consensus set by merging all reference sets and selecting significant probes in our model.\n\n\nCode\nprobelist$cgIn_consensus &lt;- unique(dt_path$cg)#intersect(row.names(sig_mod), unique(unlist(probelist)))\n\n\nNow we will look at the associated pathways to that reference set:\n\n\nCode\nsource(\"R/functions.R\")\n# Crete a list to store pathways results:\ncgIn_consensus&lt;-list()\n\n# Subset annotation to the corresponding probeset:\nanno&lt;-dt_path[probelist$cgIn_consensus,]\n\n# Get hypomethylated genes list: \ngenes.hypo &lt;- unique(unlist(sapply(\n  anno[type==\"hypo\",gene_name]\n  ,function(x)unlist(strsplit(x,\";\")))))\n\n# Get pathways associated with the previous set:\npathways.hypo &lt;- gprofiler2::gost(signif = T ,genes.hypo)\n\n# Clean results:\ndth&lt;- data.table::as.data.table(pathways.hypo[[1]])\ndth[,FDR:=p_value]\ndth[,Contrast:=\"controls\"]\ndth[,TERM:=term_name]\ndth[,source:=factor(source)]\n\npathway&lt;-path_results(dth,method=\"source\",cols = c(\"term_size\",\"query_size\",\"intersection_size\"))\n\n# Store results \ncgIn_consensus$hypo &lt;- pathway\n\n# Repeat for hypermethylated genes: \n\ngenes.hyper &lt;- unique(unlist(sapply(\n  anno[type==\"hyper\",gene_name]\n  ,function(x)unlist(strsplit(x,\";\")))))\npathways.hyper &lt;- gprofiler2::gost(signif = T ,genes.hyper)\n\n# Store results \ndth&lt;- data.table::as.data.table(pathways.hyper[[1]])\ndth[,FDR:=p_value]\ndth[,Contrast:=\"controls\"]\ndth[,TERM:=term_name]\ndth[,source:=factor(source)]\npathway&lt;-path_results(dth,method=\"source\",cols = c(\"term_size\",\"query_size\",\"intersection_size\"))\n\ncgIn_consensus$hyper&lt;-pathway\npathways_refsets[[\"cgIn_consensus\"]]&lt;-cgIn_consensus\n\n\n\n\n\n\nCode\ndtable(pathways_refsets$cgIn_consensus$hyper)\n\n\n\n\n\n\n\n\n\n\n\n\nCode\ndtable(pathways_refsets$cgIn_consensus$hypo)\n\n\n\n\n\n\n\n\n\n\n\nSelect the top significant probes in our model. We will use limma’s topTable function to get the top 5000 most significant probes.\n\n\nCode\nprobelist$cgIn_top &lt;- rownames(limma::topTable(sig_mod,number=5000))\n\n\nFor convinience the chunk of code above has been converted to a function:\n\n\nCode\npathways_refsets[[\"cgIn_top\"]]&lt;-get_pathway(probeIDs = probelist$cgIn_top,dt=dt_path)\n\n\n\n\n\n\nCode\ndtable(pathways_refsets$cgIn_top$hyper)\n\n\n\n\n\n\n\n\n\n\n\n\nCode\ndtable(pathways_refsets$cgIn_top$hypo)\n\n\n\n\n\n\n\n\n\n\n\nFrom all the reference datasets in the paper, cgSet_pre contains more DMPs in our data than any other.\n\n\nCode\nprobelist$cgIn_pre &lt;- dt_path[ref==\"cgSet_pre\",cg]\n\n\n\n\nCode\npathways_refsets[[\"cgIn_pre\"]]&lt;-get_pathway(probelist$cgIn_pre,dt=dt_path)\n\n\n\n\n\n\nCode\ndtable(pathways_refsets$cgIn_pre$hyper)\n\n\n\n\n\n\n\n\n\n\n\n\nCode\ndtable(pathways_refsets$cgIn_pre$hypo)\n\n\n\n\n\n\n\n\n\n\n\nAlthough it has less %DMPs than When we perform the t-test the dataset from PBMC cell line without changes in expression has a lower p-value.\n\n\nCode\nprobelist$cgIn_NO &lt;- dt_path[ref==\"cgSet_NO\",cg]\n\n\n\n\nCode\npathways_refsets[[\"cgIn_NO\"]]&lt;-get_pathway(probelist$cgIn_NO,dt=dt_path)\n\n\n\n\n\n\nCode\ndtable(pathways_refsets$cgIn_NO$hyper)\n\n\n\n\n\n\n\n\n\n\n\n\nCode\ndtable(pathways_refsets$cgIn_NO$hypo)"
  },
  {
    "objectID": "signature.html#sec-PBMC",
    "href": "signature.html#sec-PBMC",
    "title": "age signature",
    "section": "",
    "text": "To answer question 1.B we are going to take as a reference the work made by Wilma, T. et al Steegenga et al. (2014)\nIn their paper they present 3 datasets: 1. cgSet_Exprs: The set of probes that come from observed changes in methylation AND in expression (398 genes) 2. cgSet_NO: The set of probes that come from observed changes in methylation BUT NOT expression (2390 genes) 3. cgSet_pre: The set of probes reported to be age-related on previous literature.\nAnd we created a new one combining 2 &3: 4. cgSetm: The combination/union of cgSet_Exprs & cgSet_NO\nSo let’s prepare our data replicating their workflow:\n\n\n450k array where pre-processed and cleaned and the old subjects where compared to the young subjects.\n20,917 were significantly regulated (Lima t test, p &lt; 0.01) between the group of old and young subjects. Over 5 % methylation difference between the mean of the group of the young and old subjects was found for 10,625. 7,598 gene-related and 3,027 intergenic probes. From the 7,598 gene-related 640 probes where further discarded because of pseudo- and uncharacterized genes, antisense RNAs, long intergenic nonprotein coding RNAs and micro-RNAs.\nFinally a clean set of 6958 probes where selected and the most significant differentially expressed genes were identified using −2 &gt; t value &gt; 2 as a cut-off. Fig 2A\n\n398 genes where selected as the most significant differentially expressed genes and 170 of those have at least 2 associated DMPs.\nThe following table corresponds to supplementary table 2 and contains the data they usedin the article."
  },
  {
    "objectID": "signature.html#inhouse-data",
    "href": "signature.html#inhouse-data",
    "title": "age signature",
    "section": "",
    "text": "Loaded data has been filtered out for single nucleotide polymorphism (SNP) at or near the target CpG with minor allele frequency equal or larger than 1 % and probes that contained more than 2 SNPs.\n\n\nCode\nlibrary(data.table)\nlibrary(targets)\nlibrary(SummarizedExperiment)\nlibrary(S4Vectors)\nss &lt;- readRDS(\"data/SS.rds\")\nss_ctl &lt;- ss[Type==\"Control\",]\n\n# rgSet &lt;- cnv.methyl::read.metharray.exp.par(targets=ss_ctl,ncores = 36,folder = \"analysis/intermediate/\")\nrgSet &lt;- minfi::read.metharray.exp(targets = ss_ctl)\n\nmset &lt;- name_rgset(rgSet,ss_ctl,exclude=\"206702460034_R05C01\",newname=\"Sample_Name\")\n\ncontrols&lt;-filter(                                         # 1.- Filters: -probes: pval&lt;0.01 \n    targets=ss_ctl, rgSet=mset,sampGroups=\"Sample_Group\", #              -samples: 10% probes fail\n    qc_folder = \"analysis/\")\nss_ctl &lt;- data.table::data.table(as.data.frame(controls@colData))\n\n\n\n\n\n\n\nCode\nidcol=\"Sample_Name\"\nctl_qc_dir=params$ctl_qc_dir\ndir.create(ctl_qc_dir,recursive = T, showWarnings = F)\ncontrols_qc &lt;- \nqc(                                                       # Makes qc plots:qcReport, density, beanplot, mean_qc \n    controls,sampGroups = \"Sample_Group\",sampNames=idcol,idcol=idcol, qc_folder = ctl_qc_dir\n    )\n\n\n\n\n\ndensity_plot\n\n\n\n\n\nbean_plot\n\n\nThere are 1.05^{6} probes that pass QC and 23 control samples in our dataset.\n\n\nCode\ntable(ss_ctl$Condition)\n\n\n\n      AMN      cALD      cAMN CTL.adult CTL.child \n        0         0         0        11        12 \n\n\n\n\n\nFollowing the aforementioned paper Steegenga et al. (2014) we now normalize the data using the subset-quantile within array normalization (SWAN) method:\n\n\nCode\nlibrary(minfi)\nnorm&lt;-minfi::preprocessSWAN(controls)"
  },
  {
    "objectID": "signature.html#sec-controls",
    "href": "signature.html#sec-controls",
    "title": "age signature",
    "section": "",
    "text": "To test the effect of age on our controls we will split our samples into adult +18 and young &lt;18 subjects. Then we will fit a model to compare the methylation levels of this 2 groups.\n\n\nCode\nmvals&lt;-getM(norm) \nfull_mod&lt;-mod(object = mvals, group_var = \"Condition\",\n                        singular=F,pairwise = T,\n                        metadata = ss_ctl,\n                        idcol=\"Sample_Name\")\nsaveRDS(full_mod,\"data/full_mod.rds\")\n\n\n\n\nCode\nsig_mod&lt;-full_mod[abs(full_mod$t)&gt;2 & full_mod$p.value &lt; 0.01 ,]\n\nsaveRDS(sig_mod,\"data/sig_mod.rds\")\n\n\n139531 were significantly regulated (Lima t test, p &lt; 0.01) between the group of adult and child subjects using −2 &gt; t value &gt; 2 as a cut-off.\n\n\nCode\nlibrary(cnv.methyl)\nlibrary(minfi)\ndmps &lt;- cnv.methyl::DMPextr(fit = sig_mod,                         # Toptable & stats\n                                            ContrastsDM = colnames(sig_mod$contrasts),\n                                            beta_normalized = minfi::getBeta(controls),\n                                            p.value = 0.01,\n                                            mDiff = 0.05,\n                                            ann = minfi::getAnnotation(controls),\n                                            writeOut = F)\ndmps$Type&lt;-ifelse(dmps$diff_meanMeth&gt;0,\"Hyper\",\"Hypo\")\n\n\nFrom here we could extract our own group of DMPs comparing the two age groups from the contrasts.\n\n\nCode\nDMPs&lt;-data.table::as.data.table(dmps)\nDMPs&lt;-DMPs[,UCSC_RefGene_Name:=sapply(UCSC_RefGene_Name,function(x) paste(unique(unlist(strsplit(x,\";\"))),collapse = \";\"))]\nDMPs[nchar(UCSC_RefGene_Name)&gt;1,]\nsaveRDS(DMPs,\"data/dmps.rds\")\n\n\nSo yes, there are actually 55501 DMPs.\n\n\nIn the following plots you can observe\n\n\nCode\nplotDMP(data.table::as.data.table(dmps))\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nNow we already checked that there are methylation differences in our data by separating controls into young and old. Since our samples are only controls and the only controlled difference between them is age, this suggests that the observed methylation differences are related to that factor. Nevertheless, there could be other underlying variables affecting the methylation levels between the 2 conditions that we ignore.\nSo far, we followed the proceeding from the paper in our analysis in order to mimic their workflow so the results are comparable. Nevertheless, they also measured expression values, which they used to correlate with methylation levels in order to filter the gene candidates for their age-related profile. In our case, there is no expression, so we can’t construct a dataset of candidate genes taking into account gene expression. Eventhough, we can use the same datasets from their previous work on our data in order to see if the set with expression and without expression behave in a different way."
  },
  {
    "objectID": "signature.html#b-intersection-with-reference-datasets",
    "href": "signature.html#b-intersection-with-reference-datasets",
    "title": "age signature",
    "section": "",
    "text": "As mentioned previously, another way to find out if there is a change in methylation associated with aging in our data is looking at those sites that have been previously reported to show this association. We will use the PBMC reference datasets (with/without expression change) plus the one from previous literature that is also mentioned in the paper from Steegenga et al. (2014):\n\n\n\n\nCode\nlibrary(readxl)\npaper_betas &lt;- suppressMessages( readxl::read_excel(\"data/11357_2014_9648_MOESM2_ESM.xls\", \n    sheet = \"sTable 2S\", skip = 2))\npaper_betas2 &lt;- suppressMessages(readxl::read_excel(\"data/11357_2014_9648_MOESM2_ESM.xls\", \n    sheet = \"sTable 3S\", skip = 2))\npaper_betas3 &lt;- suppressMessages(readxl::read_excel(\"data/11357_2014_9648_MOESM2_ESM.xls\", \n    sheet = \"sTable 4S\", skip = 6))\n\n\n\n\n\nThere are 4 reference probelists:\n\ncgSet_Exprs: The set of probes that come from observed changes in methylation BUT NOT in expression (398 genes)\ncgSet_NO: The set of probes that come from observed changes in methylation AND expression (2390 genes)\ncgSetm: The combination/union of cgSet_Exprs & cgSet_NO\ncgSet_pre: The set of probes reported to be age-related on previous literature.\n\n\n\nCode\nprobelist &lt;- list(\n  cgSet_Exprs = paper_betas$ProbeID,\n  cgSet_NO = paper_betas2$ProbeID,\n  cgSetm = unique(c(paper_betas$ProbeID,paper_betas2$ProbeID)),\n  cgSet_pre = paper_betas3$`Probe nr`\n\n)\nsaveRDS(probelist,\"data/probelist.rds\")\n\n\n\n\n\nWe have 2 models, the full model, which has all the probes from the normalised data in it full_mod and the same model which has been filtered according to the same criteria as in the paper sig_mod (0.01 pval & +-2t) to keep only sites with a significant change in methylation.\nSo, as we saw in 1A we get a set of +50K DMPs, following the steps described in the paper to construct a new reference dataset from our data (excluding the part where data is crossed with expression).\nWe believe those sites are related to age because the model was built comparing old vs young healthy subjects, but there might be other factors affecting the differences in methylation, there are 2 solutions we propose:\n\nsig_mod: We could either intersect our significant probes 139531 with the sites that have been previously reported to be related with age.\nfull_mod: Test the whole reference datasets on our data.\n\nsig_mod may offer better results, since it is based on the differences present in our own data, but for the same reason it could also introduce bias.\nLet’s take a look at the sample size of each of the age_profile datasets. (4 references x 2 models = 8 datasets):\n\ndataset: The name of the reference dataset used\nN_Age_ref: Total size of the reference dataset\nN_tested: The subset of probes from each reference dataset that we tested (are present in our chip and have not been discarded in QC steps)\nN_DMPs: Number of probes that are significantlly methylated between the 2 groups that are also present in each of the age reference subset.\nobserved: Number of DMPs with percentajes relative to reference datasets.\nexpected: Expected number of DMPs + percentage of DMPs (N_DMPs/N_total)\n\n\n\nCode\nlibrary(data.table)\ntab &lt;- t(sapply(probelist,function(x) table(rownames(full_mod) %in% x)))\ntab2 &lt;- t(sapply(probelist,function(x) table(rownames(sig_mod) %in% x)))\ndtab&lt;-data.table::data.table(\n  dataset = c(rownames(tab)),\n  N_Age_ref = sapply(probelist,NROW),\n  N_tested = paste0(tab[,2], \" (\",round(tab[,2]/sapply(probelist,NROW)*100,2), \"%)\"),\n  N_DMPs = tab2[,2]\n  \n)\ndtab[,observed:=paste0(N_DMPs, \"/\", tab[,2], \" (\",round((N_DMPs/tab[,2])*100,2), \"%)\"  )]\ndtab[, expected:=paste0( round(tab[,2] * round( NROW(sig_mod$coefficients)/NROW(full_mod$coefficients) *100,2)/100),\" (\",round( NROW(sig_mod$coefficients)/NROW(full_mod$coefficients) *100,2),\"%)\")]\n\n\n\n\nCode\ndtab\n\n\n\n\n Table 1.1:  Enrichment of each age-related reference set in the age control\nmodel \n  \n\n\n\n\nSince the reference datasets have been previously reported to be associated with age, they can be used to filter the significant sites from our model to select those with further evidence to be related with ageing. In the table above we can observe that there is a good proportion of DMPs in the 2 age groups from the controls associated with these age-related references. After data preprocessing around 90% of the cgs for each reference set is present in our data, which we consider is a fair representation. Our significant dataset captures more than 30% of the probes for each reference dataset, while if you look at all the different probes from the array, the overall percentage of DMPs between young and adults is 16.14% which suggests that there is some overlap between previously reported age-related sites and DMPs between young and adult controls from our study. Nevertheless, it is also advisable to include the full reference sets in further analysis.\nTo analyse DMPs in age-related sites in the disease, we will use a combination of these reference sets, as well as sub-samples corresponding to the intersections between DMPs from our controls and the reference sets. For more about inhouse reference datasets Section 1.5 .\n\n\n\nWe can now construct each of the 8 datasets with mean beta values for young/adult groups:\n\n\nCode\nbetas &lt;- minfi::getBeta(controls)\n\n# Row index to multiply by betas taking the columns present in each contrast multiplying by 1/0\ndesign_FULL &lt;- t(full_mod$design)\n# For each row on design (columns selected for each contrast) do betas * 1/0 to get the correct columns and then do the mean values for each group:\nbetas_c_FULL &lt;-apply(design_FULL , 1 , function(x) apply(betas[,ss_ctl$Sample_Name] %*% diag(x),1 , function(y) mean(y[y!=0])))\n\nbetas_c &lt;- lapply(list(full_mod,sig_mod),function(fit){\n  # Row index to multiply by betas taking the columns present in each contrast multiplying by 1/0\n  design &lt;- t(fit$design)\n  \n  dt_c&lt;-rbindlist(lapply(names(probelist), function(n){\n    idx&lt;-intersect(probelist[[n]],rownames(fit))\n    cgs&lt;-intersect(idx,rownames(betas))\n    b &lt;- betas[cgs,]\n    # For each row on design (columns selected for each contrast) do betas * 1/0 to get the correct columns and then do the mean values for each group:\n    dt=as.data.table(apply(design , 1 , function(x) apply(b %*% diag(x),1 , function(y) mean(y[y!=0]))))\n    dt$ref=n\n    dt$cg=cgs\n    dt\n    } \n  ))\n  dt_c\n})\nnames(betas_c)&lt;- c(\"full_mod\",\"sig_mod\")\npdata&lt;-rbindlist(betas_c,idcol = \"model\")\nnames(pdata)[2:3]&lt;-c(\"adult\",\"child\")\npdata[,diff:=adult-child]\npdata&lt;-pdata[!is.na(diff),]\npdata[,type:=ifelse(diff&gt;0,\"hyper\",\"hypo\")]\n\n\nWe are ready to test mean differences and plot:\n\n\n\nAppart from a quantitative approach in order to measure at which extent each reference set is related to our data, a more qualitative measure can be obtained, based on statitics. Also, these test will tell us at which extent the differences in methylation between young and adults are significant for each of the reference sets. Imagine for example, that our data has a smaller percentage of DMPs in reference set A than in set B, but the difference in methylation for sites in A are much greater than those in B. This is the kind of qualitative measurement that the statistical test will tell us.\nMethylation data is bimodal, since the effects of methylation can either occur by hyper or hypomethylation. This means the data is not going to show a normal distribution. Thus, a wilcoxon non-parametric test is used to compare the means .\n\n\nCode\nt &lt;- pdata[,wilcox.test(child,adult)$p.value,by=c(\"ref\",\"model\")]\nt\n\n\n\n\n Table 1.2:  Young vs Adult Controls methylation distributions significance\ntest. \n  \n\n\n\n\nAlso a bimodal distribution could be transformed in 2 normal distributions if we split data into hyper and hypomethylated probes.\n\n\nCode\npdata[,sd.child:=sd(child),by=type]\npdata[,sd.adult:=sd(adult),by=type]\nz_bimodal &lt;- pdata[,c(N=.N,BSDA::z.test(child,adult,sigma.x=unique(sd.child),sigma.y=unique(sd.adult))),by=c(\"model\",\"ref\",\"type\")]\n# t_bimodal &lt;- pdata[,t.test(child,adult),by=c(\"ref\",\"model\",\"type\")]\nz_bimodal[,group:=rep(c(\"child\",\"adult\"),.N/2)]\nzt&lt;- dcast(z_bimodal, ref + model + type + N + p.value ~ group, value.var = c(\"estimate\"))\nzt[,diff:=adult-child]\ndata.table::setorder(zt,p.value,diff)\nkableExtra::kbl(zt)|&gt;kableExtra::kable_classic_2()\n\n\n\n\nTable 1.3: Young vs Adult Controls methylation distributions significance test.\n\n\nref\nmodel\ntype\nN\np.value\nadult\nchild\ndiff\n\n\n\n\ncgSet_pre\nfull_mod\nhypo\n5194\n0.00\n0.43\n0.49\n-0.06\n\n\ncgSet_pre\nsig_mod\nhypo\n2946\n0.00\n0.43\n0.51\n-0.08\n\n\ncgSetm\nfull_mod\nhyper\n3290\n0.00\n0.22\n0.18\n0.04\n\n\ncgSet_NO\nfull_mod\nhyper\n2897\n0.00\n0.22\n0.18\n0.04\n\n\ncgSetm\nsig_mod\nhyper\n1471\n0.00\n0.19\n0.13\n0.05\n\n\ncgSet_NO\nsig_mod\nhyper\n1308\n0.00\n0.19\n0.13\n0.06\n\n\ncgSet_pre\nsig_mod\nhyper\n894\n0.00\n0.31\n0.25\n0.06\n\n\ncgSet_pre\nfull_mod\nhyper\n1824\n0.00\n0.32\n0.28\n0.04\n\n\ncgSetm\nfull_mod\nhypo\n1400\n0.00\n0.49\n0.53\n-0.04\n\n\ncgSet_NO\nfull_mod\nhypo\n1184\n0.00\n0.49\n0.53\n-0.04\n\n\ncgSetm\nsig_mod\nhypo\n292\n0.00\n0.47\n0.53\n-0.07\n\n\ncgSet_NO\nsig_mod\nhypo\n247\n0.00\n0.47\n0.54\n-0.07\n\n\ncgSet_Exprs\nfull_mod\nhyper\n418\n0.00\n0.23\n0.19\n0.04\n\n\ncgSet_Exprs\nsig_mod\nhyper\n175\n0.00\n0.19\n0.13\n0.05\n\n\ncgSet_Exprs\nfull_mod\nhypo\n230\n0.04\n0.47\n0.50\n-0.03\n\n\ncgSet_Exprs\nsig_mod\nhypo\n48\n0.06\n0.46\n0.52\n-0.07\n\n\n\n\n\n\n\n\nCode\n# kableExtra::kbl(z_bimodal[,.SD,.SDcols=c(\"ref\",\"model\",\"type\",\"estimate\",\"conf.int\",\"p.value\")],digits=2) |&gt; kableExtra::kable_classic()\n\n\nIn this second statistical test, instead of comparing the distribution of the two groups we are splitting the data into hyper and hypomethylation, so it adds a new layer of information. The data in the table is sorted by p.value, so it shows the most significant first, but there is the estimate mean difference too.\nThe results show that there are significant differences.\nDataset means are all significantlly diferent (either with wilcoxon or student t test). For cgSet_pre from the literature there is a decrease in methylation with age. There is an increase in methylation for the cgSet_NO dataset (without expression) and less differences for those sites correlated with expression changes.\n\n\n\n\n\nCode\np_long&lt;-melt(pdata, measure.vars=c(\"adult\",\"child\") )\np_long[,color:=ifelse(type  == \"hyper\",\"red\",\"green\")]\n\nlibrary(ggplot2)\nlibrary(viridis)\n\n\nWarning: package 'viridis' was built under R version 4.3.0\n\n\nLoading required package: viridisLite\n\n\nCode\n  p1&lt;-ggplot(p_long, aes(x=variable, y=value, fill= variable)) +\n     geom_boxplot(aes(fill=variable),outlier.fill=\"ivory\",alpha = 0.5) +\n      # scale_fill_manual(ys=levels(col_subclass)) +\n      geom_jitter(color=p_long$color,\n                  size=0.1,show.legend = TRUE,\n                  alpha=0.2) +\n\n      #theme_ipsum() +\n      theme(\n        legend.position=\"left\",\n        plot.title = element_text(size=11)\n      ) +\n      ggtitle(\"Beta ys between young and old\") +\n      xlab(\"Cells\")+\n    ylab(\"relative fraction\")+\n            scale_x_discrete(guide = guide_axis(angle = 60))+\n    \n    facet_wrap(as.formula(paste(\"~ ref + model\" )),ncol = 4)\n  \n   \np2&lt;-ggplot(p_long[ref!=\"cgSetm\",], aes(x=variable, y=value, fill= variable)) +\n     geom_boxplot(aes(fill=variable),outlier.fill=\"ivory\",alpha = 0.5) +\n      # scale_fill_manual(ys=levels(col_subclass)) +\n      # geom_jitter(#color=pdata$color,\n      #             size=0.1,show.legend = TRUE,\n      #             alpha=0.2) +\n\n      #theme_ipsum() +\n      theme(\n        legend.position=\"left\",\n        plot.title = element_text(size=11)\n      ) +\n      ggtitle(\"Beta ys between young and old\") +\n      xlab(\"Cells\")+\n    ylab(\"relative fraction\")+\n            scale_x_discrete(guide = guide_axis(angle = 60))+\n    \n    facet_wrap(as.formula(paste(\"~ ref + model\" )),ncol = 2)\np2"
  },
  {
    "objectID": "signature.html#sec-inhouseref",
    "href": "signature.html#sec-inhouseref",
    "title": "age signature",
    "section": "",
    "text": "Since we suspect that our disease is related to accelarated aging but we don’t really know if one reference data is going to be better than the other for our disease, we created a combination of reference sets that try to capture as much variability as posible. This sets start with the prefix cgIn_ to differenciate them from the previous cgSet_.\nWe will also inspect which pathways are realted to each of these sets.\n\n\nCode\npathways_refsets&lt;-list()\n\n\nIn order to analyse which pathways are associated to the DMPs, we will first annotate the probes with gene names. To do that we will use the convinient annotation provided by illumina plataform for their EPIC methylation arrays.\n\n\nCode\nlibrary(data.table)\nlibrary(IlluminaHumanMethylationEPICanno.ilm10b2.hg19)\n\n# 1. Get gene names from EPIC annotation object\nEPIC_anno&lt;-data.table::as.data.table(as.data.frame(IlluminaHumanMethylationEPICanno.ilm10b2.hg19::Other),keep.rownames = \"cg\")\ndata.table::setkey(EPIC_anno,cg)\n\n# 2. Filter for significant probes and absolute mean difference of beta values &gt; 0.05 \ndt_path&lt;-p_long[model==\"sig_mod\"&abs(diff)&gt;0.05,.SD,.SDcols=c(\"ref\",\"cg\",\"type\",\"diff\")]\n\n# 3. add gene name information to our data.table\ndata.table::setkey(dt_path,cg)\ndt_path$gene_name &lt;- EPIC_anno[dt_path$cg,UCSC_RefGene_Name]\ndt_path$Contrast=\"controls\"\n\n\n\n\nCode\nhead(dt_path)\n\n\n\n\n  \n\n\n\n\n\nThe consensus set by merging all reference sets and selecting significant probes in our model.\n\n\nCode\nprobelist$cgIn_consensus &lt;- unique(dt_path$cg)#intersect(row.names(sig_mod), unique(unlist(probelist)))\n\n\nNow we will look at the associated pathways to that reference set:\n\n\nCode\nsource(\"R/functions.R\")\n# Crete a list to store pathways results:\ncgIn_consensus&lt;-list()\n\n# Subset annotation to the corresponding probeset:\nanno&lt;-dt_path[probelist$cgIn_consensus,]\n\n# Get hypomethylated genes list: \ngenes.hypo &lt;- unique(unlist(sapply(\n  anno[type==\"hypo\",gene_name]\n  ,function(x)unlist(strsplit(x,\";\")))))\n\n# Get pathways associated with the previous set:\npathways.hypo &lt;- gprofiler2::gost(signif = T ,genes.hypo)\n\n# Clean results:\ndth&lt;- data.table::as.data.table(pathways.hypo[[1]])\ndth[,FDR:=p_value]\ndth[,Contrast:=\"controls\"]\ndth[,TERM:=term_name]\ndth[,source:=factor(source)]\n\npathway&lt;-path_results(dth,method=\"source\",cols = c(\"term_size\",\"query_size\",\"intersection_size\"))\n\n# Store results \ncgIn_consensus$hypo &lt;- pathway\n\n# Repeat for hypermethylated genes: \n\ngenes.hyper &lt;- unique(unlist(sapply(\n  anno[type==\"hyper\",gene_name]\n  ,function(x)unlist(strsplit(x,\";\")))))\npathways.hyper &lt;- gprofiler2::gost(signif = T ,genes.hyper)\n\n# Store results \ndth&lt;- data.table::as.data.table(pathways.hyper[[1]])\ndth[,FDR:=p_value]\ndth[,Contrast:=\"controls\"]\ndth[,TERM:=term_name]\ndth[,source:=factor(source)]\npathway&lt;-path_results(dth,method=\"source\",cols = c(\"term_size\",\"query_size\",\"intersection_size\"))\n\ncgIn_consensus$hyper&lt;-pathway\npathways_refsets[[\"cgIn_consensus\"]]&lt;-cgIn_consensus\n\n\n\n\n\n\nCode\ndtable(pathways_refsets$cgIn_consensus$hyper)\n\n\n\n\n\n\n\n\n\n\n\n\nCode\ndtable(pathways_refsets$cgIn_consensus$hypo)\n\n\n\n\n\n\n\n\n\n\n\nSelect the top significant probes in our model. We will use limma’s topTable function to get the top 5000 most significant probes.\n\n\nCode\nprobelist$cgIn_top &lt;- rownames(limma::topTable(sig_mod,number=5000))\n\n\nFor convinience the chunk of code above has been converted to a function:\n\n\nCode\npathways_refsets[[\"cgIn_top\"]]&lt;-get_pathway(probeIDs = probelist$cgIn_top,dt=dt_path)\n\n\n\n\n\n\nCode\ndtable(pathways_refsets$cgIn_top$hyper)\n\n\n\n\n\n\n\n\n\n\n\n\nCode\ndtable(pathways_refsets$cgIn_top$hypo)\n\n\n\n\n\n\n\n\n\n\n\nFrom all the reference datasets in the paper, cgSet_pre contains more DMPs in our data than any other.\n\n\nCode\nprobelist$cgIn_pre &lt;- dt_path[ref==\"cgSet_pre\",cg]\n\n\n\n\nCode\npathways_refsets[[\"cgIn_pre\"]]&lt;-get_pathway(probelist$cgIn_pre,dt=dt_path)\n\n\n\n\n\n\nCode\ndtable(pathways_refsets$cgIn_pre$hyper)\n\n\n\n\n\n\n\n\n\n\n\n\nCode\ndtable(pathways_refsets$cgIn_pre$hypo)\n\n\n\n\n\n\n\n\n\n\n\nAlthough it has less %DMPs than When we perform the t-test the dataset from PBMC cell line without changes in expression has a lower p-value.\n\n\nCode\nprobelist$cgIn_NO &lt;- dt_path[ref==\"cgSet_NO\",cg]\n\n\n\n\nCode\npathways_refsets[[\"cgIn_NO\"]]&lt;-get_pathway(probelist$cgIn_NO,dt=dt_path)\n\n\n\n\n\n\nCode\ndtable(pathways_refsets$cgIn_NO$hyper)\n\n\n\n\n\n\n\n\n\n\n\n\nCode\ndtable(pathways_refsets$cgIn_NO$hypo)"
  },
  {
    "objectID": "signature.html#amn_adults",
    "href": "signature.html#amn_adults",
    "title": "age signature",
    "section": "2.1 AMN_Adults:",
    "text": "2.1 AMN_Adults:\nSince we only have childs with the cerebral condition, and we believe that the disease could behave differently in childs and adults, we will first only focus in adults with AMN, cAMN (AMN + cerebral) and controls.\n\n\nCode\nlibrary(data.table)\nss_adults &lt;- readRDS(\"data/ss_Adults.rds\")\n\nrgSet &lt;- cnv.methyl::read.metharray.exp.par(targets=ss_adults,ncores = 36,folder = \"analysis/intermediate/\")\nrgSet &lt;- minfi::read.metharray.exp(targets = ss_adults)\n\nmset &lt;- name_rgset(rgSet,ss_adults,exclude=\"206702460034_R05C01\",newname=\"Sample_Name\")\n\nadults&lt;-filter(                                         # 1.- Filters: -probes: pval&lt;0.01 \n    targets=ss_adults, rgSet=mset,sampGroups=\"Sample_Group\", #              -samples: 10% probes fail\n    qc_folder = \"analysis/\")\nss_adults &lt;- data.table::data.table(as.data.frame(adults@colData))\n\n\n\n\nCode\ntable(ss_adults$Type)\n\n\n\nControl Disease \n     11      60 \n\n\nAlso, we can distinguish between controls and the two types of disease AMN and cerebral.\n\n\nCode\ntable(droplevels.factor(ss_adults$Condition))\n\n\n\n      AMN      cAMN CTL.adult \n       52         8        11 \n\n\nThus, we have 2 possible different comparisons. Either we group togehter all the patients or we distinguish 2 phenotypes.\n\n2.1.1 Normalization:\nFollowing the aforementioned paper Steegenga et al. (2014) we now normalize the data using the subset-quantile within array normalization (SWAN) method:\n\n\nCode\nlibrary(minfi)\nnorm&lt;-minfi::preprocessSWAN(adults)\nclean &lt;- prep(norm, remove_sex=F, arraytype=\"EPIC\")\n\n\n\n\n2.1.2 Methylation differences:\nSince we are interested in age related differences caused by the disease we must remove normal methylation changes due to age. Then remaining differences in methylation in previously selected age-related probes can be attributed to the disease phenotypes. There are 2 ways of removing the effects of age.\n\nWe can remove the effect of Age from the data by regressing on Age and using the residuals to fit a second model. Then we can use the disease group as the predictor variable to see if any group is showing more methylation than the controls for the age-specific sites.\nAnother option is to add Age as a covariate in the model.\n\n\n2.1.2.1 Model1: correct for age and use residuals:\n\n\nCode\nbvals&lt;-getM(clean) \ndesign &lt;- model.matrix(~Age,data = ss_adults)\nss_adults &lt;- ss_adults[ss_adults$Sample_Name %in% colnames(bvals)]\nage_fit &lt;- limma::lmFit(bvals, design=design )\nres &lt;- residuals(age_fit, bvals)\n\n\nNow we perform a linear model comparing disease and control group:\n\n\nCode\nres_mod_ext &lt;- mod(object = res, group_var = \"Condition\",\n                        singular=F,pairwise = T,\n                        metadata = ss_adults,\n                        idcol=\"Sample_Name\")\nres_mod &lt;- mod(object = res, group_var = \"Type\",\n                        singular=F,pairwise = T,\n                        metadata = ss_adults,\n                        idcol=\"Sample_Name\")\n\n\n\n\nCode\nsig_res_mod&lt;-res_mod[abs(res_mod$t)&gt;2 & res_mod$p.value &lt; 0.01 ,]\n\n\n1.44^{4} were significantly regulated (Lima t test, p &lt; 0.01) between the group of adult and child subjects using −2 &gt; t value &gt; 2 as a cut-off.\n\n\nCode\nlibrary(cnv.methyl)\nlibrary(minfi)\ndmps &lt;- cnv.methyl::DMPextr(fit = sig_res_mod,                         # Toptable & stats\n                                            ContrastsDM = colnames(res_mod$contrasts),\n                                            beta_normalized = getBeta(clean),\n                                            p.value = 0.01,\n                                            mDiff = 0.05,\n                                            ann = minfi::getAnnotation(adults),\n                                            writeOut = F)\ndmps$Type &lt;- ifelse(dmps$diff_meanMeth &gt; 0,\"Hyper\",\"Hypo\")\ndmps&lt;-as.data.table(dmps, keep.rownames=T)\nsaveRDS(dmps,\"data/dmps_adults_res.rds\")\ndmps_ext &lt;- cnv.methyl::DMPextr(fit = res_mod_ext,                         # Toptable & stats\n                                            ContrastsDM = colnames(res_mod_ext$contrasts),\n                                            beta_normalized = getBeta(clean),\n                                            p.value = 0.01,\n                                            mDiff = 0.05,\n                                            ann = minfi::getAnnotation(adults),\n                                            writeOut = F)\ndmps_ext$Type &lt;- ifelse(dmps_ext$diff_meanMeth &gt; 0,\"Hyper\",\"Hypo\")\ndmps_ext&lt;- as.data.table(dmps_ext[abs(dmps_ext$t)&gt;2 & dmps_ext$P.Value &lt; 0.01,],keep.rownames = T)\n\nsaveRDS(dmps_ext,\"data/dmps_adults_ext.rds\")\n\n\nThe 2 dmp sets can be merged together into a single data.frame:\n\n\nCode\nlibrary(data.table)\nDMPs &lt;- rbind(dmps, dmps_ext)\n\nDMPs&lt;-DMPs[,UCSC_RefGene_Name:=sapply(UCSC_RefGene_Name,function(x) paste(unique(unlist(strsplit(x,\";\"))),collapse = \";\"))]\nsaveRDS(DMPs,\"data/dmps_adults.rds\")\n\n\nSo there are 255 DMPs.\nThis is the number of DMPs for each of the Contrasts:\n\n\nCode\ntable(DMPs$Contrast)\n\n\n\n       AMN-cAMN  cAMN-CTL.adult Disease-Control \n             19              24             212 \n\n\n\n2.1.2.1.1 DMP plots\n\n\nCode\nplotDMP(data.table::as.data.table(DMPs))\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n2.1.2.2 Model2: Add age as a covariate:\n\n\nCode\nbvals2&lt;-getM(clean) \n\nmod2_ext &lt;- mod(object = bvals2, group_var = \"Condition\",\n                        singular=F,pairwise = T,\n                        metadata = ss_adults,covs = \"Age\",\n                        idcol=\"Sample_Name\")\nmod2 &lt;- mod(object = bvals2, group_var = \"Type\",\n                        singular=F,pairwise = T,\n                        metadata = ss_adults, covs = \"Age\",\n                        idcol=\"Sample_Name\")\n\n\n\n\nCode\nsig_mod2&lt;-mod2[abs(mod2$t)&gt;2 & mod2$p.value &lt; 0.01 ,]\n# Have to check the filters for each of the 3 contrasts by sepparate for example applying lapply on contrast. Will make one dmp for each of the contrasts.\n# sig_mod2_ext&lt;-mod2_ext[abs(mod2_ext$t)&gt;2 & mod2_ext$p.value &lt; 0.01 ,]\n\n\nwere significantly regulated (Lima t test, p &lt; 0.01) between the group of adult and child subjects using −2 &gt; t value &gt; 2 as a cut-off.\n\n\nCode\nlibrary(cnv.methyl)\nlibrary(minfi)\ndmps &lt;- cnv.methyl::DMPextr(fit = sig_mod2,                         # Toptable & stats\n                                            ContrastsDM = colnames(sig_mod2$contrasts),\n                                            beta_normalized = minfi::getBeta(clean),\n                                            p.value = 0.01,\n                                            mDiff = 0.05,\n                                            ann = minfi::getAnnotation(adults),\n                                            writeOut = F)\ndmps$Type &lt;- ifelse(dmps$diff_meanMeth &gt; 0,\"Hyper\",\"Hypo\")\ndmps&lt;-as.data.table(dmps, keep.rownames=T)\nsaveRDS(dmps,\"data/dmps_mod2.rds\")\ndmps_ext &lt;- cnv.methyl::DMPextr(fit = mod2_ext,                         # Toptable & stats\n                                            ContrastsDM = colnames(mod2_ext$contrasts),\n                                            beta_normalized = minfi::getBeta(clean),\n                                            p.value = 0.01,\n                                            mDiff = 0.05,\n                                            ann = minfi::getAnnotation(adults),\n                                            writeOut = F)\ndmps_ext$Type &lt;- ifelse(dmps_ext$diff_meanMeth &gt; 0,\"Hyper\",\"Hypo\")\ndmps_ext&lt;- as.data.table(dmps_ext[abs(dmps_ext$t)&gt;2 & dmps_ext$P.Value &lt; 0.01,],keep.rownames = T)\nsaveRDS(dmps_ext,\"data/dmps_mod2_ext.rds\")\n\n\nThe 2 dmp sets can be merged together into a single data.frame:\n\n\nCode\nlibrary(data.table)\nDMPs2 &lt;- rbind(dmps, dmps_ext)\n\nDMPs2&lt;-DMPs2[,UCSC_RefGene_Name:=sapply(UCSC_RefGene_Name,function(x) paste(unique(unlist(strsplit(x,\";\"))),collapse = \";\"))]\nNROW(DMPs2)\n\n\nSo there are 258 DMPs2.\n\n\nCode\ntable(DMPs2$Contrast)\n\n\n\n       AMN-cAMN  cAMN-CTL.adult Disease-Control \n             24               4             230 \n\n\n\n2.1.2.2.1 DMPs plots:\n\n\nCode\nplotDMP(data.table::as.data.table(DMPs2))\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n2.1.2.3 Model comparison:\nBoth models seem to yield very similar results. Let’s put it together:\n\n\nCode\nDMPs_tab &lt;- rbind(\n  cbind(model=\"m1\",DMPs[,table(Type, Contrast)]),\n  cbind(model=\"m2\",DMPs2[,table(Type, Contrast)])\n)\n\ndata.frame(DMPs_tab)\n\n\n\n\n  \n\n\n\nThere are no significative differences between AMN and the controls, maybe because the hetereogeneity of AMN group and the inbalance on the samples. In any case, if they exist the differences are very subtle and they can be attributed to age.\n\n\nCode\nDMPs2[Contrast == \"AMN-CTL.adult\",list(probe=rn,chr,pos,Type,Beta_difference=round(diff_meanMeth,2),gene=UCSC_RefGene_Name,UCSC_RefGene_Group,Relation_to_Island) ]\n\n\n\n\n  \n\n\n\nNevertheless there are some sites spotted for cAMN vs controls. Furthermore, the number of DMPs is increased for the contrast AMN-cAMN.\n\n\nCode\ndt2 &lt;- DMPs2[Contrast == \"AMN-cAMN\",list(probe=rn,Contrast,chr,pos,Type,Beta_difference=round(diff_meanMeth,2),gene=UCSC_RefGene_Name,UCSC_RefGene_Group,Relation_to_Island) ]\nrange(dt2[[\"Beta_difference\"]])\n\n\n[1] -0.10 -0.05\n\n\nCode\nhead(dt2[order(-abs(dt2[[\"Beta_difference\"]]))],20)\n\n\n\n\n  \n\n\n\nAs shown in the table above there are much higher differences between the 2 conditions than between either of them with the control. This suggest that rather than having more methylation in the same direction by favouring similar methylation processes there may be different mechanisms involved methylating different sites for AMN and cAMN.\nAnd here is a table with top 10 DMP sites for each contrast:\n\n\nCode\ndt10 &lt;- DMPs2[,list(probe=rn,Contrast,chr,pos,Type,Beta_difference=round(diff_meanMeth,2),gene=UCSC_RefGene_Name,UCSC_RefGene_Group,Relation_to_Island) ]\ndmp10&lt;-dt10[order(-abs(Beta_difference)),head(.SD,10),by=Contrast]\ndtable(dmp10)\n\n\n\n\n\n\n\nYou can take a look at the scatter plots on how do the beta values of each of these 24 sites change with age here Section 2.1.3.3.1\n\n\n\n2.1.3 reference vs Adults:\n\n2.1.3.1 data inspection:\nWe have 4 models:\n\nAge corrected by fitting residuals (m1):\n\nres_mod 2 factors: control & disease\nres_mod_ext3 factors: 2 disease AMN cAMN + controls\n\nCondition + Age as covariate:\n\nmod22 factors: control & disease\nmod2_ext 3 factors: 2 disease AMN cAMN + controls\n\n\nWe have 8 reference sets, inside our probelist list object. The same 4 reference sets used previously with the controls with cgsites extracted from the paper supplementary material (tables 2S, 3S & 4S) plus the 4 datasets that come from our own controls by comparing young and old healthy subjects Section 1.5.\nIn order to assess the enrichment of each dataset for our disease in a quantitative manner, the percentage of probes in each of the sets that are significantlly methylated is calculated.\n\n\nCode\ncont&lt;-colnames(res_mod_ext$contrasts)\n\ntab &lt;- t(sapply(probelist,function(x) table(rownames(res_mod) %in% x)))\ntab2 &lt;- t(sapply(probelist,function(x) table(rownames(sig_res_mod) %in% x)))\ntab3 &lt;- sapply(\n  probelist,\n  function(p) length(intersect(rownames(sig_res_mod),p))\n  )\n\ntab4 &lt;- data.table::as.data.table(sapply(cont,function(x){\n  tval &lt;- res_mod_ext$t[,x]\n  pval &lt;- res_mod_ext$p.value[,x]\n  tval.i &lt;- which(abs(tval) &gt; 2 )\n  pval.i &lt;- which(pval &lt; 0.01)\n  i&lt;-intersect(tval.i, pval.i)\n  cg=names(tval[i])\n  sapply(probelist,function(p) length(intersect(cg,p)))\n  }),keep.rownames = T)\n\ndtab&lt;-tab4[,\"Disease-Control\":=tab2[,2]]\ndtab[,\"Common_probes\":=tab[,2]]\ndtab[, total := sapply(probelist,NROW)]\ndtab[, model := \"m1\"]\n\n#### model2\ntab &lt;- t(sapply(probelist,function(x) table(rownames(mod2) %in% x)))\ntab2 &lt;- t(sapply(probelist,function(x) table(rownames(sig_mod2) %in% x)))\ntab3 &lt;- sapply(cont,function(x){\n  x=names(mod2_ext$t[,x])\n  sapply(probelist,function(p) length(intersect(x,p)))\n  })\n\ntab4 &lt;- data.table::as.data.table(sapply(cont,function(x){\n  tval &lt;- mod2_ext$t[,x]\n  pval &lt;- mod2_ext$p.value[,x]\n  tval.i &lt;- which(abs(tval) &gt; 2 )\n  pval.i &lt;- which(pval &lt; 0.01)\n  i&lt;-intersect(tval.i, pval.i)\n  cg=names(tval[i])\n  sapply(probelist,function(p) length(intersect(cg,p)))\n  }),keep.rownames = T)\n\ndtab2&lt;-tab4[,\"Disease-Control\":=tab2[,2]]\ndtab2[,\"Common_probes\":=tab[,2]]\ndtab2[, total := sapply(probelist,NROW)]\ndtab2[, model := \"m2\"]\n\nDtab &lt;- rbind(dtab,dtab2)\nper &lt;- Dtab[,c( Common_probes, total,\n             lapply(.SD,function(x)paste0(x,\" (\",round(x/as.numeric(Common_probes) *100,2),\"%)\"))\n),by=c(\"rn\",\"model\"),.SDcols=cont]\n\n\n\n\nCode\nper\n\n\n\n\n  \n\n\n\nIn general, all the sets perform in a similar way except for the one selecting top5000 DMPs.\nThe 2 sets that seem to be more enriched for age-related methylation changes are the one based on our own controls cgIn_top and the one with no associated expression change cgIn_NO. It is not surprising to see that the set of probes based on the differences observed from our own data outperforms the sets coming from other sources.\nIn respect with the set with no-expression, in the paper they hypothesize that methylation changes uncorrelated with changes in expression may be caused by aging.\n\n\n2.1.3.2 Betas:\nNow let’s take the beta values in consideration:\n\n2.1.3.2.1 Betas residual model:\n\n\nCode\nbetas &lt;- M2B(res)\n\n\n\nmodels&lt;-list(res_mod=res_mod,\n             res_mod_ext=res_mod_ext\n             # mod2=mod2,\n             # mod2_ext=mod2_ext,\n             \n             )\n\nbetas_res &lt;- lapply(names(models),function(model_name){\n  # Row index to multiply by betas taking the columns present in each contrast multiplying by 1/0\n  fit&lt;-models[[model_name]]\n  design &lt;- t(fit$design)\n\n  dt_c&lt;-rbindlist(lapply(names(probelist), function(n){\n    idx&lt;-intersect(probelist[[n]],rownames(fit))\n    cgs&lt;-intersect(idx,rownames(betas))\n    b &lt;- betas[cgs,]\n    # For each row on design (columns selected for each contrast) do betas * 1/0 to get the correct columns and then do the mean values for each group:\n    dt=as.data.table(apply(design , 1 , function(x) apply(b %*% diag(x),1 , function(y) mean(y[y!=0]))))\n    dt$ref=n\n    dt$cg&lt;-cgs\n    dt$model=model_name\n    dt\n    b&lt;-melt(dt,id.vars = c(\"ref\",\"cg\",\"model\"),variable.name = \"Condition\",value.name = \"bVal\")-&gt;b\n    b\n    }\n  ))\n  dt_c\n})\nnames(betas_res)&lt;-names(models)\ndtb_res &lt;- rbindlist(betas_res)\ndtbm_res &lt;- melt(dtb_res, value.name = \"bVal\",)\ndtbm_res &lt;- dtbm_res[Condition!=\"Age\"]\ndtbm_res$model &lt;- \"residuals\"\n\nb2_dt &lt;- as.data.table(res,keep.rownames = \"cg\")\nb2_m &lt;- melt(b2_dt,variable.name = \"Sample_Name\", value.name = \"bVal\")\nb2_res&lt;-merge(b2_m,ss_adults[,.SD, .SDcols=c(\"Sample_Name\", \"Age\",\"Condition\")])\nb2_res$model=\"residuals\"\n\n\n\n\nCode\nbetas &lt;- M2B(bvals2)\nmodels&lt;-list(\n  # res_mod=res_mod,\n  # res_mod_ext=res_mod_ext\n  mod2=mod2,\n  mod2_ext=mod2_ext\n)\n\nbetas_cov &lt;- lapply(names(models),function(model_name){\n  # Row index to multiply by betas taking the columns present in each contrast multiplying by 1/0\n  fit&lt;-models[[model_name]]\n  design &lt;- t(fit$design)\n\n  dt_c&lt;-rbindlist(lapply(names(probelist), function(n){\n    idx&lt;-intersect(probelist[[n]],rownames(fit))\n    cgs&lt;-intersect(idx,rownames(betas))\n    b &lt;- betas[cgs,]\n    # For each row on design (columns selected for each contrast) do betas * 1/0 to get the correct columns and then do the mean values for each group:\n    dt=as.data.table(apply(design , 1 , function(x) apply(b %*% diag(x),1 , function(y) mean(y[y!=0]))))\n    dt$ref=n\n    dt$cg&lt;-cgs\n    dt$model=model_name\n    dt\n    b&lt;-melt(dt,id.vars = c(\"ref\",\"cg\",\"model\"),variable.name = \"Condition\",value.name = \"bVal\")-&gt;b\n    b\n    }\n  ))\n  dt_c\n})\nnames(betas_cov)&lt;-names(models)\ndtb_cov &lt;- rbindlist(betas_cov)\ndtbm_cov &lt;- melt(dtb_cov, value.name = \"bVal\",)\ndtbm_cov &lt;- dtbm_cov[Condition!=\"Age\"]\ndtbm_cov$model &lt;- \"covariate\"\n\n\nb2_dt &lt;- as.data.table(betas,keep.rownames = \"cg\")\nb2_m &lt;- melt(b2_dt,variable.name = \"Sample_Name\", value.name = \"bVal\")\nb2_cov&lt;-merge(b2_m,ss_adults[,.SD, .SDcols=c(\"Sample_Name\", \"Age\",\"Condition\")])\nb2_cov$model=\"covariate\"\n\n\n\n\nCode\n# Mean Beta values for the contrasts:\npdata&lt;-rbind(dtbm_cov,dtbm_res)\npdata&lt;-pdata[!is.na(bVal),]\npdata&lt;-pdata[Condition !=\"Age\",]\npdata[startsWith( model,\"res_mod\"),model:=\"residuals\"]\npdata[startsWith( model,\"mod2\"),model:=\"covariate\"]\nsaveRDS(pdata,\"data/pdata_adults.rds\")\n\n\n\n\nCode\n#Beta Values for individual samples: \npdata_indiv&lt;-rbind(b2_cov,b2_res) \nsaveRDS(pdata_indiv,\"data/pdata_adults_indiv.rds\")\n\n\nWe are ready to test mean differences and plot:\n\n\n\n2.1.3.3 Plots:\nLet’s see at the general distribution of the density plot.\n\n\nCode\nde&lt;-limma::plotDensities(mod2_ext)\nde\n\n\nWe see that cAMD looks the more extreme\n\n2.1.3.3.1 top10 Beta vs age plot\nHere we inspect the top DMP sites individually. We selected the top 10 DMPs for each of the contrasts:\n\n\nCode\ntable(dmp10$Contrast)\n\n\n\n       AMN-cAMN  cAMN-CTL.adult Disease-Control \n             10               4              10 \n\n\n\n\nCode\nlibrary(ggplot2)\nlibrary(gridExtra)\n\n\nWarning: package 'gridExtra' was built under R version 4.3.0\n\n\n\nAttaching package: 'gridExtra'\n\n\nThe following object is masked from 'package:minfi':\n\n    combine\n\n\nThe following object is masked from 'package:Biobase':\n\n    combine\n\n\nThe following object is masked from 'package:BiocGenerics':\n\n    combine\n\n\nCode\nplt_list_DMP &lt;- list()\nfor (cont in unique(dtp$Contrast)){\n  dtp_c &lt;- dtp[Contrast == cont,]\n  dt_mean &lt;- dtp_c[,list(b=mean(bVal),avage=mean(Age)),by=c(\"Condition\",\"model\",\"cg\")]\nplt_list_DMP[[cont]]&lt;-ggplot(dtp_c, aes(x = Age, y = bVal, color=Condition, group=factor(model) )) +\n    geom_point() +\n    # ylim(0, 1) +\n    geom_point(data=dt_mean,aes(x=avage,y=b,col=Condition),size=4,shape=24)  +\n    geom_smooth(aes(group=Condition),\n              method = \"lm\", formula = y ~ x, se = F) +\n\n    labs(title=paste0('Beta values vs. Age: ', cont, ' top 10 Differentially methylated sites.'), x='Age', y='Residuals') +\n      facet_grid(cg ~ Contrast, margins = F)\n\n}\nplt_list_DMP\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n2.1.3.4 Significance test:\n\n\nCode\nlibrary(data.table)\npdata&lt;-pdata_adults\npdata_res&lt;-pdata[model == \"covariate\",]\nzt&lt;-list()\npdata_res[,sd:=stats::sd(bVal),by=c(\"model\",\"Condition\")]\nsd_tab&lt;-pdata_res[,unique(sd),by=Condition]\npdata_res_w&lt;-dcast(pdata_res,cg+model+ref~Condition,value.var = c(\"bVal\"))\nz_bimodal_Disease &lt;- pdata_res_w[,c(\n  N=.N,\n  BSDA::z.test(\n    TypeControl,\n    TypeDisease,\n    sigma.x=sd_tab[Condition==\"TypeControl\",V1],\n    sigma.y=sd_tab[Condition==\"TypeDisease\",V1]\n    )\n  ),by=c(\"ref\",\"model\")]\nz_bimodal_Disease[,group:=rep(c(\"Ctl\",\"Case\"),.N/2)]\nz_bimodal_Disease[,condition:=\"Disease\"]\nzt[[\"Disease\"]] &lt;- dcast(z_bimodal_Disease, ref + model + condition+ N + p.value ~ group, value.var = c(\"estimate\"))\n\n\n\nz_bimodal_AMN &lt;- pdata_res_w[,c(\n  N=.N,\n  BSDA::z.test(\n    ConditionCTL.adult,\n    ConditionAMN,\n    sigma.y=sd_tab[Condition==\"ConditionCTL.adult\",V1],\n    sigma.x=sd_tab[Condition==\"ConditionAMN\",V1]\n    )\n  ),by=c(\"ref\",\"model\")]\n\nz_bimodal_AMN[,group:=rep(c(\"Ctl\",\"Case\"),.N/2)]\nz_bimodal_AMN[,condition:=\"AMN\"]\nzt[[\"AMN\"]] &lt;- dcast(z_bimodal_AMN, ref + model + condition+ N + p.value ~ group, value.var = c(\"estimate\"))\n\nz_bimodal_cAMN &lt;- pdata_res_w[,c(\n  N=.N,\n  BSDA::z.test(\n    ConditionCTL.adult,\n    ConditioncAMN,\n    sigma.x=sd_tab[Condition==\"ConditionCTL.adult\",V1],\n    sigma.y=sd_tab[Condition==\"ConditioncAMN\",V1]\n        )\n  ),by=c(\"ref\",\"model\")]\nz_bimodal_cAMN[,group:=rep(c(\"Ctl\",\"Case\"),.N/2)]\nz_bimodal_cAMN[,condition:=\"cAMN\"]\nzt[[\"cAMN\"]] &lt;- dcast(z_bimodal_cAMN, ref + model + condition+  N + p.value ~ group, value.var = c(\"estimate\"))\n\nztab&lt;-rbindlist(zt)\n# t_bimodal &lt;- pdata_res[,t.test(child,adult),by=c(\"ref\",\"model\",\"type\")]\n\nztab[,diff:=Case-Ctl]\ndata.table::setorder(ztab,p.value,diff)\nkableExtra::kbl(ztab)|&gt;kableExtra::kable_classic_2()\n\n\n\n\nTable 2.1: Adult Disease vs Adult Controls methylation distributions significance test.\n\n\nref\nmodel\ncondition\nN\np.value\nCase\nCtl\ndiff\n\n\n\n\ncgIn_top\ncovariate\ncAMN\n4696\n0.00\n0.51\n0.48\n0.02\n\n\ncgSetm\ncovariate\ncAMN\n4556\n0.04\n0.32\n0.31\n0.01\n\n\ncgSet_NO\ncovariate\ncAMN\n3956\n0.06\n0.32\n0.31\n0.01\n\n\ncgIn_literature\ncovariate\nAMN\n3021\n0.09\n0.48\n0.47\n0.01\n\n\ncgSetm\ncovariate\nAMN\n4556\n0.10\n0.30\n0.31\n-0.01\n\n\ncgIn_literature\ncovariate\nDisease\n3021\n0.10\n0.48\n0.47\n0.01\n\n\ncgSet_NO\ncovariate\nAMN\n3956\n0.12\n0.30\n0.31\n-0.01\n\n\ncgIn_consensus\ncovariate\ncAMN\n3840\n0.12\n0.44\n0.43\n0.01\n\n\ncgIn_literature\ncovariate\ncAMN\n3021\n0.13\n0.48\n0.47\n0.01\n\n\ncgIn_top\ncovariate\nDisease\n4696\n0.14\n0.49\n0.48\n0.01\n\n\ncgSet_pre\ncovariate\ncAMN\n6878\n0.16\n0.43\n0.42\n0.01\n\n\ncgIn_NO\ncovariate\nAMN\n841\n0.21\n0.27\n0.29\n-0.01\n\n\ncgSetm\ncovariate\nDisease\n4556\n0.24\n0.30\n0.31\n-0.01\n\n\ncgSet_pre\ncovariate\nDisease\n6878\n0.26\n0.43\n0.42\n0.00\n\n\ncgSet_NO\ncovariate\nDisease\n3956\n0.27\n0.30\n0.31\n-0.01\n\n\ncgSet_pre\ncovariate\nAMN\n6878\n0.28\n0.43\n0.42\n0.00\n\n\ncgIn_NO\ncovariate\nDisease\n841\n0.30\n0.28\n0.29\n-0.01\n\n\ncgIn_consensus\ncovariate\nDisease\n3840\n0.32\n0.43\n0.43\n0.00\n\n\ncgIn_top\ncovariate\nAMN\n4696\n0.33\n0.49\n0.48\n0.00\n\n\ncgIn_consensus\ncovariate\nAMN\n3840\n0.37\n0.43\n0.43\n0.00\n\n\ncgSet_Exprs\ncovariate\ncAMN\n638\n0.38\n0.33\n0.32\n0.01\n\n\ncgSet_Exprs\ncovariate\nAMN\n638\n0.57\n0.32\n0.32\n-0.01\n\n\ncgIn_NO\ncovariate\ncAMN\n841\n0.64\n0.29\n0.29\n0.00\n\n\ncgSet_Exprs\ncovariate\nDisease\n638\n0.71\n0.32\n0.32\n0.00\n\n\n\n\n\n\n\n\nCode\n# kableExtra::kbl(z_bimodal[,.SD,.SDcols=c(\"ref\",\"model\",\"type\",\"estimate\",\"conf.int\",\"p.value\")],digits=2) |&gt; kableExtra::kable_classic()\n\n\n\n\nCode\npdata&lt;-pdata_adults\npdata_res&lt;-pdata[model == \"residuals\",]\nzt&lt;-list()\npdata_res[,sd:=stats::sd(bVal),by=c(\"model\",\"Condition\")]\nsd_tab&lt;-pdata_res[,unique(sd),by=Condition]\npdata_res_w&lt;-dcast(pdata_res,cg+model+ref~Condition,value.var = c(\"bVal\"))\nz_bimodal_Disease &lt;- pdata_res_w[,c(\n  N=.N,\n  BSDA::z.test(\n    TypeControl,\n    TypeDisease,\n    sigma.x=sd_tab[Condition==\"TypeControl\",V1],\n    sigma.y=sd_tab[Condition==\"TypeDisease\",V1]\n    )\n  ),by=c(\"ref\",\"model\")]\nz_bimodal_Disease[,group:=rep(c(\"Ctl\",\"Case\"),.N/2)]\nz_bimodal_Disease[,condition:=\"Disease\"]\nzt[[\"Disease\"]] &lt;- dcast(z_bimodal_Disease, ref + model + condition+ N + p.value ~ group, value.var = c(\"estimate\"))\n\n\n\nz_bimodal_AMN &lt;- pdata_res_w[,c(\n  N=.N,\n  BSDA::z.test(\n    ConditionCTL.adult,\n    ConditionAMN,\n    sigma.y=sd_tab[Condition==\"ConditionCTL.adult\",V1],\n    sigma.x=sd_tab[Condition==\"ConditionAMN\",V1]\n    )\n  ),by=c(\"ref\",\"model\")]\n\nz_bimodal_AMN[,group:=rep(c(\"Ctl\",\"Case\"),.N/2)]\nz_bimodal_AMN[,condition:=\"AMN\"]\nzt[[\"AMN\"]] &lt;- dcast(z_bimodal_AMN, ref + model + condition+ N + p.value ~ group, value.var = c(\"estimate\"))\n\nz_bimodal_cAMN &lt;- pdata_res_w[,c(\n  N=.N,\n  BSDA::z.test(\n    ConditionCTL.adult,\n    ConditioncAMN,\n    sigma.x=sd_tab[Condition==\"ConditionCTL.adult\",V1],\n    sigma.y=sd_tab[Condition==\"ConditioncAMN\",V1]\n        )\n  ),by=c(\"ref\",\"model\")]\nz_bimodal_cAMN[,group:=rep(c(\"Ctl\",\"Case\"),.N/2)]\nz_bimodal_cAMN[,condition:=\"cAMN\"]\nzt[[\"cAMN\"]] &lt;- dcast(z_bimodal_cAMN, ref + model + condition+  N + p.value ~ group, value.var = c(\"estimate\"))\n\nztab&lt;-rbindlist(zt)\n# t_bimodal &lt;- pdata_res[,t.test(child,adult),by=c(\"ref\",\"model\",\"type\")]\n\nztab[,diff:=Case-Ctl]\ndata.table::setorder(ztab,p.value,diff)\nkableExtra::kbl(ztab)|&gt;kableExtra::kable_classic_2()\n\n\n\n\nTable 2.2: Adult Disease vs Adult Controls methylation distributions significance test.\n\n\nref\nmodel\ncondition\nN\np.value\nCase\nCtl\ndiff\n\n\n\n\ncgIn_top\nresiduals\ncAMN\n4696\n0\n0.52\n0.50\n0.02\n\n\ncgSetm\nresiduals\ncAMN\n4556\n0\n0.52\n0.50\n0.02\n\n\ncgSet_NO\nresiduals\ncAMN\n3956\n0\n0.52\n0.50\n0.02\n\n\ncgSetm\nresiduals\nAMN\n4556\n0\n0.50\n0.50\n-0.01\n\n\ncgSet_NO\nresiduals\nAMN\n3956\n0\n0.50\n0.50\n-0.01\n\n\ncgIn_literature\nresiduals\nDisease\n3021\n0\n0.50\n0.49\n0.01\n\n\ncgIn_literature\nresiduals\nAMN\n3021\n0\n0.50\n0.49\n0.01\n\n\ncgIn_NO\nresiduals\nAMN\n841\n0\n0.49\n0.51\n-0.02\n\n\ncgSetm\nresiduals\nDisease\n4556\n0\n0.50\n0.50\n-0.01\n\n\ncgIn_NO\nresiduals\nDisease\n841\n0\n0.50\n0.51\n-0.01\n\n\ncgIn_consensus\nresiduals\ncAMN\n3840\n0\n0.51\n0.50\n0.01\n\n\ncgSet_NO\nresiduals\nDisease\n3956\n0\n0.50\n0.50\n-0.01\n\n\ncgSet_pre\nresiduals\ncAMN\n6878\n0\n0.50\n0.50\n0.01\n\n\ncgSet_Exprs\nresiduals\ncAMN\n638\n0\n0.52\n0.50\n0.02\n\n\ncgSet_pre\nresiduals\nDisease\n6878\n0\n0.50\n0.50\n0.00\n\n\ncgIn_literature\nresiduals\ncAMN\n3021\n0\n0.50\n0.49\n0.01\n\n\ncgIn_NO\nresiduals\ncAMN\n841\n0\n0.53\n0.51\n0.01\n\n\ncgIn_consensus\nresiduals\nDisease\n3840\n0\n0.50\n0.50\n0.00\n\n\ncgSet_pre\nresiduals\nAMN\n6878\n0\n0.50\n0.50\n0.00\n\n\ncgIn_consensus\nresiduals\nAMN\n3840\n0\n0.50\n0.50\n0.00\n\n\ncgSet_Exprs\nresiduals\nAMN\n638\n0\n0.50\n0.50\n-0.01\n\n\ncgIn_top\nresiduals\nDisease\n4696\n0\n0.50\n0.50\n0.00\n\n\ncgSet_Exprs\nresiduals\nDisease\n638\n0\n0.50\n0.50\n0.00\n\n\ncgIn_top\nresiduals\nAMN\n4696\n0\n0.50\n0.50\n0.00\n\n\n\n\n\n\n\n\nCode\n# kableExtra::kbl(z_bimodal[,.SD,.SDcols=c(\"ref\",\"model\",\"type\",\"estimate\",\"conf.int\",\"p.value\")],digits=2) |&gt; kableExtra::kable_classic()\n\n\nWe see there is a small difference in methylation for the dataset cgSetm which combines data that comes from PBMC cells, although that seems to be specially true for the subset with no correlation with expression changes. For more information about the pathways associated with the set of methylated genes for each reference set take a look at Section 1.5 set"
  },
  {
    "objectID": "signature.html#pathways",
    "href": "signature.html#pathways",
    "title": "age signature",
    "section": "3.1 Pathways:",
    "text": "3.1 Pathways:\n\n3.1.1 Hyper pathways:\n\n\nCode\ndtable(pathways_desease$hyper)\n\n\n\n\n\n\n\n\n\n3.1.2 Hypo pathways:\n\n\nCode\ndtable(pathways_desease$hypo)"
  },
  {
    "objectID": "references.html",
    "href": "references.html",
    "title": "Bibliography",
    "section": "",
    "text": "References"
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "XALD Methylation Project",
    "section": "",
    "text": "XALD Project: Study of methylation changes in Age-related cg sites associated with XALD disease\nThis book is created to give answer to the following questions:\n\nIs there an age-accelerating factor for XALD patients according to the changes in methylation?\nWhich is the methylation mark associated with XALD disease?\n\n\n\n\n\n\nImage by Kip Lyall.\n\n\n\nView Large Image \n\n\nFigure Viewer\n\n\nDownload Hi-res image \n\n\nDownload (PPT)"
  }
]